---
title: "Corona-Stat.lt"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    fig_width: 9
    fig_height: 6
    fig_caption: true
    theme: flatly
editor_options:
  chunk_output_type: console
---
![](figures/corona-stat-logo.png)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, error = TRUE, warning = FALSE, message = FALSE)
```

```{r, include=FALSE}
# loading packets that are needed for running the .Rmd
source("./scripts/loading_R_packets.R")
```

```{r, include=FALSE}
# importing JHCSSE and LT data, data preparation
dir.create("./data/")
source("./scripts/data_import_preparation_word.R")
source("./scripts/data_import_preparation_word_map.R")
source("./scripts/data_import_preparation_LT.R")
```

```{r, include=FALSE}
shape <- readOGR("./shape_files/ne_50m_admin_0_sovereignty.shp",
                 encoding = "utf-8",
                 use_iconv = T,
                 verbose = FALSE,
                 stringsAsFactors = FALSE)%>%
  st_as_sf(countries)%>%
  select(SOVEREIGNT, POP_EST)%>%
  mutate(POP_EST=as.numeric(POP_EST))

```

```{r, include=FALSE}
# todo
# reikia importą zipo ir failo paėmimą iš zipo padaryt, nes dabar iš working directory ima

# INFO:
# https://www.naturalearthdata.com/downloads/50m-cultural-vectors/50m-admin-0-countries-2

# URL <- "https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/ne_50m_admin_0_sovereignty.zip"
# download.file(url=URL, destfile ="./data/ne_50m_admin_0_sovereignty.zip", method = "auto")
# unzip("./data/ne_50m_admin_0_sovereignty.zip", exdir = "./data/")
# countries <- readOGR(dsn="./data/ne_50m_admin_0_sovereignty.shp",
#                              encoding = "utf-8",
#                              use_iconv = T,
#                              verbose = FALSE,
#                      stringsAsFactors = FALSE)
#  countries <- st_as_sf(countries)
#  ggplot(countries)+ geom_sf()

```



# Info

Koronos virusas (SARS-CoV-2) pirmą kartą užfiksuotas lapkričio 17 d. Kinijoje, visgi Kinija ilgą laiką neigė ir slėpė informaciją apie viruso plitimą. Sausio pabaigoje užfiksuoti pirmieji atvejai Europoje. Lietuvoje pirmą kartą virusas diagnozuotas vasario 28 d. Po pradinės ramybės, sparčiai pradėjus daugėti naujiems atvejams, pradėjo didėti ir visuomenės bei žiniasklaidos dėmesys šiam virusui ir jo paplitimui šalyje. Nors internete yra įvairų statistikų, kuriose pateikiama globali statistika, mūsų nuomone Lietuvoje reikėjo tinklapio, kuriame greitai būtų galima įvertinti atrinktą svarbiausią statistiką, ne tik apie pasaulinę (europinę) statistiką, bet ir apie paplitimą Lietuvoje bei kitus svarbius faktus.

**Šį puslapį rengia**

* Arminte Globytė (VU EVAF)
* Justas Mundeikis (Lithuanian-Economy.net)
* Rokas Klydžia
* Tomas Dzedulionis (VU EVAF)

Aptikus netikslumų arba turint klausimų bei pasiūlymų galite kreiptis el. paštu: corona-stat@protonmail.com

**Tinklapio aktualumas**

* statistika / grafikai / lentelės ataujinami - 09:00, 12:00, 15:00, 18:00, 21:00 Lietuvos laiku
* tekstas šiuo metu dar pildomas, atnaujinimus planuojame kartą per savaitę

**Duomenys**

Šiame tinklapyje pateikiami apibendrinti statistiniai rodikliai, kurie remiasi 

* John Hopkins CSSE ([link](https://github.com/CSSEGISandData/COVID-19)) renkama pasauline statistika
* Mūsų komandos renkama Lietuvos statistika
* Kitais šaltiniais - Eurostat, Lietuvos statistikos departamento, Lietuvos Banko bei kt.

**PERSPĖJIMAS**

Tinklapis vis dar tebėra rengiamas, todėl galimi laikini sutrkimai. Tinklapio "baigtinė" versija planuojama atsiras - 2020-03-22.

# Pasaulinė statistika
Žemiau pateikiama atrinkta statistika, kuri leidžia geriau įvertinti coronos viruso paplitimą pasaulyje.

## Paplitimas pasaulyje{.tabset .tabset-fade .tabset-pills}

### Visi patvirtinti
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="confirmed",
         date==max(date))
max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T),10, 100, 1000, 10000, max(df$value, na.rm = T))

ggplot(df, aes(fill=value))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt")

```

### Visi patvirtinti / pop.
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="confirmed",
         date==max(date))

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*1000000)

# summary(df$value_pop)
# min(df$value_pop,na.rm = T)
# max(df$value_pop,na.rm = T)

my_breaks <- c(0.1,1,10,100,1500,20000)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius tenkantis 1 mln. gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt")
```

### Visi aktyvūs
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="active",
         date==max(date))
max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(1, 10, 100, 1000, 10000)

ggplot(df, aes(fill=value))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Aktyvių pacientų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt")

```

### Aktyvūs / pop.
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="active",
         date==max(date))

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*1000000)

# summary(df$value_pop)
# min(df$value_pop,na.rm = T)
# max(df$value_pop,na.rm = T)

my_breaks <- c(0.01,0.1,1,15,200)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Apsikrėtusiųjų skaičius tenkantis 1 mln. gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt")
```

## Kita statistika {.tabset .tabset-fade .tabset-pills}
### Susirgę, pasveikę, mirę
```{r, echo=FALSE}
df <- read.csv("./data/data_world.csv",
                       stringsAsFactors = FALSE)%>%
        mutate(date=as.Date(date))%>%
        mutate(var=factor(var, levels=c("active", "recovered", "deaths")))%>%
        filter(var!="confirmed")%>%
        group_by(date, var)%>%
        summarise(value=sum(value))

max.date <- max(df$date)


ggplot(df, aes(x=date, y=value, fill=var))+
        geom_area(alpha=0.5)+
        scale_fill_manual(values=c("red", "green", "black"))+
        scale_x_date(breaks="1 week")+
        scale_y_continuous(breaks =pretty_breaks())+
        labs(title=paste0("COVID-19 (last update ", max.date,")"),
             subtitle = "Source: 2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by Johns Hopkins CSSE",
             x="Date",
             y="Count")+
        theme(legend.title=element_blank(),
              legend.position='bottom',
              axis.text.x = element_text(angle = 45, hjust = 1))
```

### Top 5 pasaulio šalys
```{r, echo=FALSE}
df <- read.csv("./data/data_world.csv",
                 stringsAsFactors = FALSE)%>%
       filter(var=="confirmed")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:5,]%>%
  gather(date, value, 4:ncol(.))%>%
        mutate(date=as.Date(date))

ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
        geom_line(size=1.1)+
        geom_point(size=2)+
    scale_color_brewer(palette="Set1",type = "qualitative", name="Valstybės")+
        labs(
          title="Susirgimų skaičius daugiausia patvirtintų atvejų turinčiose pasaulio šalyse",
          subtitle="Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt",
          x="Laikotarpis",
          y="Susirgimų skaičius"
          )+
  scale_x_date(breaks = "1 week")+
        theme(axis.text=element_text(size=8),
              axis.text.x=element_text(angle=45, hjust=1))

```


### Top 10 šalių be Kinijos
```{r, echo=FALSE}
df <- read.csv("./data/data_world.csv",
                 stringsAsFactors = FALSE)%>%
       filter(var=="confirmed")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[2:10,]%>%
  gather(date, value, 4:ncol(.))%>%
        mutate(date=as.Date(date))

ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
        geom_line(size=1.1)+
        geom_point(size=2)+
    scale_color_brewer(palette="Set1",type = "qualitative", name="Valstybės")+
        labs(
          title="Susirgimų skaičius daugiausia patvirtintų atvejų turinčiose pasaulio šalyse",
          subtitle="Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt",
          x="Laikotarpis",
          y="Susirgimų skaičius"
          )+
  scale_x_date(breaks = "1 week")+
        theme(axis.text=element_text(size=8),
              axis.text.x=element_text(angle=45, hjust=1))

```


# Europos statistika
## Paplitimas europoje {.tabset .tabset-fade .tabset-pills}
### Visi patvirtinti
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="confirmed",
                CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date),)

max.date <- max(df$date)


df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(1,10, 100, 1000, 20000)

ggplot(df, aes(fill=value))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
       geom_sf_label(aes(label =round(value,0)), size=2.5, fill="white" )+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt")

```

### Visi patvirtinti / pop.
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="confirmed",
                CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date),)

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*1000000)

# summary(df$value_pop)
# min(df$value_pop,na.rm = T)
# max(df$value_pop,na.rm = T)

my_breaks <- c(0.5,2.5, 10,50,250)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius tenkantis 1 mln. gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt")
```

### Visi aktyvūs
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="active",
                CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date),)


df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(20, 200, 2000, 20000)

ggplot(df, aes(fill=value))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
         geom_sf_label(aes(label =round(value,0)), size=2.5, fill="white" )+
  labs(title=paste0("Aktyvių pacientų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt")

```

### Aktyvūs / pop.
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="active",
                CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date),)


max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*1000000)

# summary(df$value_pop)
# min(df$value_pop,na.rm = T)
# max(df$value_pop,na.rm = T)

my_breaks <- c(0.3,2,10,70,300)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Apsikrėtusiųjų skaičius tenkantis 1 mln. gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: corona-stat.lt")
```

## Kita statistika {.tabset .tabset-fade .tabset-pills}
### Nauji užsikrėtimai
```{r, echo=FALSE}
df <- read.csv("./data/data_world.csv",
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))

df %<>%filter(valstybe%in%c("Airija","Lietuva","Austrija","Liuksemburgas",
                            "Belgija", "Malta" ,"Bulgarija","Nyderlandai",
                            "Čekija","Portugalija","Danija","Prancūzija",
                            "Estija","Rumunija","Graikija","Slovakija", 
                            "Ispanija","Slovėnija","Italija","Suomija","Kipras",
                            "Švedija","Kroatija","Vengrija","Latvija",
                            "Vokietija","Lenkija"), 
              var=="confirmed" )

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-3|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=.[,5]-.[,4])%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,value), y=value, fill=valstybe, group=valstybe)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Susirgimų skaičius", 
       title=paste0("Naujų susirgimų per paskutines 3d. skaičius ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: www.corona-stat.lt" )+
   theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

### Naujų užsikrėtimai / pop
```{r, echo=FALSE}
df <- read.csv("./data/data_world.csv",
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))

df %<>%filter(valstybe%in%c("Airija","Lietuva","Austrija","Liuksemburgas",
                            "Belgija", "Malta" ,"Bulgarija","Nyderlandai",
                            "Čekija","Portugalija","Danija","Prancūzija",
                            "Estija","Rumunija","Graikija","Slovakija", 
                            "Ispanija","Slovėnija","Italija","Suomija","Kipras",
                            "Švedija","Kroatija","Vengrija","Latvija",
                            "Vokietija","Lenkija"), 
              var=="confirmed" )

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-3|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=.[,5]-.[,4])%>%
  select (valstybe, value)

pop <- get_eurostat("tps00001") %>% filter(time=="2019-01-01")%>%
        mutate(valstybe=countrycode(geo, 
                                    origin = "eurostat", 
                                    destination =  "cldr.short.lt",
                                    nomatch = NULL ))%>%
  mutate(pop=values)%>%
  select(valstybe,pop) %>%
  right_join(df, pop, by="valstybe")%>%
        mutate(value=round((value/pop*100000),1))%>%
        select(valstybe, value)

ggplot(pop,aes(x=reorder(valstybe,value), y=value)) +
        geom_bar(stat='identity',
                 fill="steelblue")+
    geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Susirgimų skaičius", 
       title=paste0("Naujų susirgimų skaičius 100.000 gyventojų per paskutines 3d. ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE Skaičiavimai: corona-stat.lt" )+
   theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

### Nauji užsikrėtimai proc. pokytis
```{r, echo=FALSE}
df <- read.csv("./data/data_world.csv",
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))

df %<>%filter(valstybe%in%c("Airija","Lietuva","Austrija","Liuksemburgas",
                            "Belgija", "Malta" ,"Bulgarija","Nyderlandai",
                            "Čekija","Portugalija","Danija","Prancūzija",
                            "Estija","Rumunija","Graikija","Slovakija", 
                            "Ispanija","Slovėnija","Italija","Suomija","Kipras",
                            "Švedija","Kroatija","Vengrija","Latvija",
                            "Vokietija","Lenkija"), 
              var=="confirmed" )

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-3|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=round(.[,5]/.[,4]*100),0)

ggplot(df,aes(x=reorder(valstybe,value), y=value, fill=valstybe, group=valstybe)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Naujų susirgimų per paskutines 3d. pokytis % ( ", max.date+1, " duomenimis)"),
       subtitle="Šaltinis: www.corona-stat.lt",
       x="Valstybė", 
       y="proc. pokytis")+
   theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

### Susirgimų pokytis paskelbus karantiną
```{r, echo=FALSE}
df<- read.csv("./data/data_world.csv",
               stringsAsFactors = FALSE)%>%
        filter(var=="confirmed", valstybe%in%c("Airija", "Austrija", "Belgija", "Čekija", "Danija", 
                                               "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lietuva", "Liuksemburgas", "Nyderlandai", "Norvegija",
                                               "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Vengrija", "Vokietija"), 
               var=="confirmed" )%>%
        spread(date, value)%>%
        arrange(desc(.[,ncol(.)]))%>%
        .[1:5,]%>%
        gather(date, value, 4:ncol(.))%>%
        mutate(date=as.Date(date)) %>%
        group_by(valstybe) %>%
        mutate(diff = value - lag(value, default = first(value))) %>%
        select (valstybe,date, diff)

blt <-  read.csv("./data/data_world.csv",
                 stringsAsFactors = FALSE)%>%
        filter(var=="confirmed", valstybe%in%c("Estija", "Latvija", "Lenkija", "Lietuva"))%>%
        mutate(date=as.Date(date)) %>%
        group_by(valstybe) %>%
        mutate(diff = value - lag(value, default = first(value))) %>%
        select (valstybe,date, diff)

df <- rbind(df,blt)

valstybe<-c("Airija", "Austrija", "Belgija", "Čekija", "Danija", 
            "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lietuva", "Liuksemburgas", "Nyderlandai", "Norvegija",
            "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Vengrija", "Vokietija")
diena<-c("2020-03-13", "2020-03-11","2020-03-18", "2020-03-16","2020-03-13", "2020-03-12","2020-03-16", "2020-03-14","2020-03-16", "2020-03-11","2020-03-11",
         "2020-03-13","2020-03-17", "2020-03-11","2020-03-16", "2020-03-13","2020-03-11", "2020-03-12","2020-03-12", "2020-03-16","2020-03-16", "2020-03-16","2020-03-20", "2020-03-16"
         ,"2020-03-13", "2020-03-15")

dff<-data.frame(valstybe,diena) %>%
        mutate(diena=as.Date(as.character(diena)))

df <- left_join(df,dff)

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
        geom_area(alpha=0.5, color="darkred", fill="red")+
        scale_x_date()+
        labs(title=paste0('Covid-19 susirgimų pokytis TOP5 ir Baltijos valstybėse įvedus karantiną',
                          max.date+1), subtitle=" Šaltinis: corona-stat.lt", x="Data", y="Susirgimų skaičius")+
        facet_wrap(~valstybe, ncol=3, scales='free_y')+
        geom_vline(data = df, mapping = aes(xintercept = diena), color="blue" , size=1.1)
```

### Susirgimų/pasveikimų/mirčių santykis
```{r, echo=FALSE}
df <- read.csv("./data/data_world.csv",
                       stringsAsFactors = FALSE)%>%
                mutate(date=as.Date(date))%>%
                mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))%>%
  filter(valstybe%in%c("Airija", "Austrija", "Belgija", "Bulgarija", "Čekija", "Danija", 
                                        "JK", "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lichtenšteinas", "Lietuva", "Liuksemburgas", 
                                        "Malta", "Nyderlandai", "Norvegija", "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Švedija", "Vengrija", "Vokietija"), var=="confirmed") %>%
                spread(date, value)%>%
                arrange(desc(.[,ncol(.)]))%>%
                .[1:6,]%>%
                gather(date, value, 4:ncol(.))%>%
                mutate(date=as.Date(date))%>%
                select(valstybe, date, value, var)
        
        names<-as.vector(unique(df$valstybe))
        max.date<-max(df$date)
        
        df <- read.csv("./data/data_world.csv",
                       stringsAsFactors = FALSE)%>%
                mutate(date=as.Date(date))%>%
                mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed"))) %>% 
                filter(valstybe%in%names, var!="confirmed")%>%
                select(valstybe, date, value, var)%>%
                group_by(valstybe)
        
        ggplot(df, aes(x=date, y=value, fill=var)) +
                geom_area(alpha=0.5) +
                labs(title=paste0('Covid-19 atvejai TOP6 Europos šalyse ',
                                  max.date+1," duomenimis"), subtitle=" Šaltinis: corona-stat.lt", x="Data", y="Susirgimų skaičius") +
                scale_fill_manual(values=c('red', 'green', 'black'), labels=c("Aktyvūs","Pasveikę","Mirtys")) +
                theme(legend.position='bottom',
                      axis.text.x=element_text(angle=45, hjust=1)) +
                facet_wrap(~valstybe, ncol=3, scales='free_y', nrow=2)

```

### Bendras atvejų skaičius
```{r, echo=FALSE}
        data_world <- read.csv("./data/data_world.csv",
                               stringsAsFactors = FALSE)%>%
                mutate(date=as.Date(date))%>%
                mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))
        susirgimaiEU <- data_world%>%filter(valstybe%in%c("Airija", "Austrija", "Belgija", "Bulgarija", "Čekija", "Danija", 
                                                          "JK", "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lichtenšteinas", "Lietuva", "Liuksemburgas", 
                                                          "Malta", "Nyderlandai", "Norvegija", "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Švedija", "Vengrija", "Vokietija"), var!="confirmed") %>%
                group_by(date, var)%>%
                summarise(value=sum(value))
        
        max.date<-max(df$date)

        ggplot(susirgimaiEU, aes(x=date, y=value, fill=var))+
                geom_area(alpha=0.5)+
                scale_fill_manual(values=c("red", "green", "black"),  labels=c("Aktyvūs","Pasveikę","Mirtys"))+ 
                scale_x_date(breaks="1 week")+
                scale_y_continuous(breaks =pretty_breaks())+
                labs(title=paste0("Bendras COVID-19 atvejų skaičius Europoje ", max.date+1," duomenimis"),
                     subtitle = "Šaltinis: 2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by Johns Hopkins CSSE",
                     x="Data",
                     y="Skaičius")+
                theme(legend.title=element_blank(),
                      legend.position='bottom',
                      axis.text.x = element_text(angle = 45, hjust = 1))
```

### Bendras naujų susirgimų kitimas
```{r, echo=FALSE}
        df <- read.csv("./data/data_world.csv",
                       stringsAsFactors = FALSE)%>%
                mutate(date=as.Date(date))%>%
                mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))
        df <- df%>%filter(valstybe%in%c("Airija", "Austrija", "Belgija", "Bulgarija", "Čekija", "Danija", 
                                        "JK", "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lichtenšteinas", "Lietuva", "Liuksemburgas", 
                                        "Malta", "Nyderlandai", "Norvegija", "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Švedija", "Vengrija", "Vokietija"), var=="confirmed" )
      
         dff <- df%>%
                group_by(valstybe) %>%
                mutate(diff = value - lag(value, default = first(value))) %>%
                select (valstybe,date, diff)%>%
                        group_by(date)%>%
                        summarise(diff=sum(diff))
         
         max.date<-max(df$date)
         
        ggplot(dff, aes(x=date, y=diff)) +
                geom_point(size=2,color="black")+
                scale_x_date(breaks="1 week")+
                scale_y_continuous(breaks = seq(0, max(dff$diff), by = 1000))+
                labs(x="Data", y="Susirgimų skaičius", title=paste0('Covid-19 nauji susirgimai Europoje ',max.date+1," duomenimis"),
                    subtitle="Šaltinis: www.corona-stat.lt")+
                geom_smooth(fill="red")

```

### Pasveikimai
```{r, echo=FALSE}
        df <- read.csv("./data/data_world.csv",
                               stringsAsFactors = FALSE)%>%
                mutate(date=as.Date(date))%>%
                mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))%>%
                filter(valstybe%in%c("Airija", "Austrija", "Belgija", "Bulgarija", "Čekija", "Danija", 
                                           "JK", "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lichtenšteinas", "Lietuva", "Liuksemburgas", 
                                           "Malta", "Nyderlandai", "Norvegija", "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Švedija", "Vengrija", "Vokietija"), var=="recovered") %>%
                spread(date, value)%>%
                arrange(desc(.[,ncol(.)]))%>%
                .[1:6,]%>%
                gather(date, value, 4:ncol(.))%>%
                mutate(date=as.Date(date))%>%
                select(valstybe, date, value, var)
        
        max.date<-max(df$date)
        
        ggplot(df, aes(x=date, y=value, fill=var)) +
                geom_area(alpha=0.5, color="black", fill="green") +
                labs(title=paste0('Pasveikusių žmonių skaičius TOP 6 Europos valstybėse ', max.date+1), subtitle="Šaltinis: corona-stat.lt",
                     x="Data", y="Skaičius") +
               theme(legend.position='bottom',
              axis.text.x=element_text(angle=45, hjust=1)) +
                facet_wrap(~valstybe, ncol=3, scales='free_y', nrow=2)   
```

### Mirtys
```{r, echo=FALSE}
        df <- read.csv("./data/data_world.csv",
                               stringsAsFactors = FALSE)%>%
                mutate(date=as.Date(date))%>%
                mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))%>%
                filter(valstybe%in%c("Airija", "Austrija", "Belgija", "Bulgarija", "Čekija", "Danija", 
                                                    "JK", "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lichtenšteinas", "Lietuva", "Liuksemburgas", 
                                                    "Malta", "Nyderlandai", "Norvegija", "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Švedija", "Vengrija", "Vokietija"), var=="deaths") %>%
                spread(date, value)%>%
                arrange(desc(.[,ncol(.)]))%>%
                .[1:6,]%>%
                gather(date, value, 4:ncol(.))%>%
                mutate(date=as.Date(date))%>%
                select(valstybe, date, value, var)
        
        max.date<-max(df$date)
        
        ggplot(df, aes(x=date, y=value, fill=var)) +
                geom_area(alpha=0.5, color="grey", fill="black") +
                labs(title=paste0('Covid-19 sukeltų mirčių skaičius TOP 6 Europos valstybėse ',
                                  max.date+1),
                     subtitle="Šaltinis: corona-stat.lt",
                     x="Data", y="Skaičius") +
                theme(legend.position='bottom',
              axis.text.x=element_text(angle=45, hjust=1))+
                facet_wrap(~valstybe, ncol=3, nrow = 2, scales='free_y')   

```

### Top 5 Valstybės
```{r, echo=FALSE}

        df <- read.csv("./data/data_world.csv",
                       stringsAsFactors = FALSE)%>%
                filter(var=="confirmed", valstybe%in%c("Airija", "Austrija", "Belgija", "Bulgarija", "Čekija", "Danija", 
                                                       "JK", "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lichtenšteinas", "Lietuva", "Liuksemburgas", 
                                                       "Malta", "Nyderlandai", "Norvegija", "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Švedija", "Vengrija", "Vokietija"))%>%
                spread(date, value)%>%
                arrange(desc(.[,ncol(.)]))%>%
                .[1:5,]%>%
                gather(date, value, 4:ncol(.))%>%
                mutate(date=as.Date(date))

max.date<-max(df$date)

        ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
                geom_line(size=1.1)+
                geom_point(size=2)+
                scale_color_brewer(palette="Set1",type = "qualitative", name="Valstybės")+
                labs(
                        title="Susirgimų skaičius 5-iose daugiausia patvirtintų atvejų turinčiose Europos šalyse ",max.date+1,
                        subtitle="Šaltinis:corona-stat.lt",
                        x="Laikotarpis",
                        y="Susirgimų skaičius"
                )+
                scale_x_date(breaks = "1 week")+
                theme(axis.text=element_text(size=8),
                      axis.text.x=element_text(angle=45, hjust=1))

```

# Lietuva {.tabset .tabset-fade .tabset-pills}
## Visi patvirtinti
```{r, echo=FALSE}
df <- read.csv("./data/data_lt_county_cum.csv",
                           header = TRUE,
                           stringsAsFactors = FALSE)%>%
        mutate(date=as.Date(date))%>%
    filter(var=="confirmed",
           date==max(date))

EU_shape <- get_eurostat_geospatial(output_class = "sf", resolution = "60", nuts_level = "3")%>%
  filter(CNTR_CODE=="LT")

df <- left_join(EU_shape, df, by="NUTS_ID")


my_breaks <- c(1,2,4,7,10)

ggplot(df, aes(fill=values))+
  geom_sf()+
    scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
           geom_sf_label(aes(label =round(values,0)), size=5, fill="white" )+
  labs(title=paste0("Visi patvirinti atvejai (duomenys ",max.date,")"),
       subtitle = "Šaltinis ir skaičiavimai: corona-stat.lt",
       x="",
       y="")

```


Lietuvoje šiuo metu iš viso patvirtintų atvejų - `r sum(df$values, na.rm=TRUE)`


## Visi aktyvūs
```{r, echo=FALSE}
df <- read.csv("./data/data_lt_county_cum.csv",
                           header = TRUE,
                           stringsAsFactors = FALSE)%>%
        mutate(date=as.Date(date))%>%
    filter(var=="active",
           date==max(date))

EU_shape <- get_eurostat_geospatial(output_class = "sf", resolution = "60", nuts_level = "3")%>%
  filter(CNTR_CODE=="LT")

df <- left_join(EU_shape, df, by="NUTS_ID")


my_breaks <- c(2,4,6,10)

ggplot(df, aes(fill=values))+
  geom_sf()+
    scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
           geom_sf_label(aes(label =round(values,0)), size=5, fill="white" )+
  labs(title=paste0("Aktyvūs atvejai (duomenys ",max.date,")"),
       subtitle = "Šaltinis ir skaičiavimai: corona-stat.lt",
       x="",
       y="")
```

Lietuvoje šiuo metu iš viso aktyvių atvėjų - `r sum(df$values, na.rm=TRUE)`

# Ekonominiai rodikliai

Šioje skiltyje pristatomi naujausi ekonominiai rodikliai, kurie padeda atspindėti koronos viruso pasekmes ekonomikai.

![comic: https://xkcd.com/2280/](https://imgs.xkcd.com/comics/2010_and_2020.png )

## Lietuva{.tabset .tabset-fade .tabset-pills}
### BVP
### Pramonės produkcija
### Užsienio prekyba
### Mažmeninė preyba
### Infliacija
### Kreditai
### Užimtumas / nedarbas

## Pagrindinės ES šalys{.tabset .tabset-fade .tabset-pills}
### BVP
### Pramonės produkcija
### Užsienio prekyba
### Mažmeninė preyba
### Infliacija
### Kreditai
### Užimtumas / nedarbas


# Prognozės
## Sergamumo statistikos prognozės

![https://xkcd.com/2281/](https://imgs.xkcd.com/comics/coronavirus_research.png)

## Ekonominės prognozės
