---
title: "Corona-Stat.lt"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    fig_width: 9
    fig_height: 6
    fig_caption: true
    theme: flatly
editor_options:
  chunk_output_type: console
---
![](figures/corona-stat-logo.png)
**Naujausias update: `r format(Sys.time(), "%Y-%m-%d %H:%M")`**

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, collapse = TRUE, error = TRUE, warning = FALSE, message = FALSE)
```

```{r, include=FALSE}
# loading packets that are needed for running the .Rmd
source("./scripts/loading_R_packets.R")
```

```{r, include=FALSE}
# importing JHCSSE and LT data, data preparation
dir.create("./data/")
source("./scripts/data_import_preparation_world.R")
source("./scripts/data_import_GS.R")
# source("./scripts/vmi.R")
```

```{r, include=FALSE}
# loading shape files
#source: 
shape <- readOGR("./shape_files/ne_50m_admin_0_sovereignty.shp",
                 encoding = "utf-8",
                 use_iconv = T,
                 verbose = FALSE,
                 stringsAsFactors = FALSE)%>%
  st_as_sf(countries)%>%
  select(SOVEREIGNT, POP_EST)%>%
  mutate(POP_EST=as.numeric(POP_EST))

# source: Eurostat
EU_shape <- get_eurostat_geospatial(output_class = "sf", resolution = "60", nuts_level = "3")%>%
  filter(CNTR_CODE=="LT")
```


```{r, include= FALSE}

demo_r_pjangrp <- get_eurostat("demo_r_pjangrp3", 
                               stringsAsFactors = FALSE, 
                               filters = list(age="TOTAL",
                                              sex="T",
                                              time="2019"))%>%
  rename(NUTS_ID=geo,
         pop=values)
```


```{r, include=FALSE}

data_world <- read.csv("./data/data_world.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed", "deaths")))

data_lt_country <- read.csv("./data/data_lt_country.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed","active", "recovered", "deaths")))

data_lt_country_cum <- read.csv("./data/data_lt_country_cum.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed","active", "recovered", "deaths")))

data_lt_county <- read.csv("./data/data_lt_county.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed","active", "recovered", "deaths")))

data_lt_county_cum <- read.csv("./data/data_lt_county_cum.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed","active", "recovered", "deaths")))

data_lt <- read.csv("./data/data_lt.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))

data_lv <- read.csv("./data/data_lv.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))

data_ee <- read.csv("./data/data_ee.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))

vmi <- read_excel("./data/vmi.xlsx")%>%
  na.omit()

```

# Info

Koronos virusas (SARS-CoV-2) pirmą kartą užfiksuotas lapkričio 17 d. Kinijoje, visgi Kinija ilgą laiką neigė ir slėpė informaciją apie viruso plitimą. Sausio pabaigoje užfiksuoti pirmieji atvejai Europoje. Lietuvoje pirmą kartą virusas diagnozuotas vasario 28 d. Po pradinės ramybės, sparčiai pradėjus daugėti naujiems atvejams, pradėjo didėti ir visuomenės bei žiniasklaidos dėmesys šiam virusui ir jo paplitimui šalyje. Nors internete yra įvairų statistikų, kuriose pateikiama globali statistika, mūsų nuomone Lietuvoje reikėjo tinklapio, kuriame greitai būtų galima įvertinti atrinktą svarbiausią statistiką, ne tik apie pasaulinę (europinę) statistiką, bet ir apie paplitimą Lietuvoje bei kitus svarbius faktus.

**Šį puslapį rengia**

* Arminte Globytė (VU EVAF)
* Justas Mundeikis (Lithuanian-Economy.net)
* Rokas Klydžia
* Tomas Dzedulionis (VU EVAF)

Aptikus netikslumų arba turint klausimų bei pasiūlymų galite kreiptis el. paštu: corona-stat@protonmail.com

**Tinklapio aktualumas**

* statistika:
* pasaulinė statistika (JHCSSE) atnaujinama kartą per parą (~03:00)
* Lietuvos statistika atnaujinama kelis kartus dienos eigoje
* grafikai / lentelės ataujinami - 09:00, 12:00, 15:00, 18:00, 21:00 Lietuvos laiku
* tekstas šiuo metu dar pildomas, atnaujinimus planuojame kartą per savaitę

**Duomenys**

Šiame tinklapyje pateikiami apibendrinti statistiniai rodikliai, kurie remiasi 

* John Hopkins CSSE ([link](https://github.com/CSSEGISandData/COVID-19)) renkama pasauline statistika
* Mūsų komandos renkama Lietuvos statistika
* Kitais šaltiniais - Eurostat, Lietuvos statistikos departamento, Lietuvos Banko bei kt.

**PERSPĖJIMAS**

Tinklapis vis dar tebėra rengiamas, todėl galimi laikini sutrkimai. Tinklapio "baigtinė" versija planuojama atsiras - 2020-03-22.

# Pasaulinė statistika
Žemiau pateikiama atrinkta statistika, kuri leidžia geriau įvertinti coronos viruso paplitimą pasaulyje.

## Pasaulis - žemėlapiai{.tabset .tabset-fade .tabset-pills}
### Užsikrėtimai (abs.)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         date==max(date))

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T),10, 100, 1000, 10000, max(df$value, na.rm = T))

ggplot(df, aes(fill=value))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```

### Užsikrėtimai (/pop.)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         date==max(date))

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*1000000)

# summary(df$value_pop)
# min(df$value_pop,na.rm = T)
# max(df$value_pop,na.rm = T)

my_breaks <- c(0.1,1,10,100,1500,20000)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius tenkantis 1 mln. gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")
```

### Nauji (abs.)
```{r, echo=FALSE}
df <- data_world%>%
  filter(var=="confirmed",
         date==max(date)-1 | date==max(date) )%>%
  spread(date, value)%>%
  mutate(diff=.[,6]-.[,5])%>%
  select(1,4,7)%>%
  rename(value=diff)

max.date <- max(data_world$date)
```

Žemiau pateikiamas naujų registruotų atvejų absoliutus skaičiaus pokytis per paskutinę parą (`r max.date-1` - `r max.date`). Iš šio žemėlapio galima matyti, kur atsirado daugiausiai naujų atvejų.

```{r, echo=FALSE}

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T),1, 10, 100, 1000, max(df$value, na.rm = T))


ggplot(df, aes(fill=value))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Naujų atvejų skaičiaus pokytis per paskutinę parą (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```


### Nauji (proc.)
```{r, echo=FALSE}
df <- data_world%>%
  filter(var=="confirmed",
         date==max(date)-1|date==max(date))%>%
  spread(date, value)%>%
  mutate(diff=round((.[,6]/.[,5]-1)*100,1))%>%
  filter(.[,5]>=500)%>% # to exclude inf as result sof x/0
  select(1,4,7)%>%
  rename(value=diff)

max.date <- max(data_world$date)
```

Žemiau pateikiamas naujų registruotų atvejų skaičiaus santykinis pokytis (procentais) per paskutinę parą (`r max.date-1` - `r max.date` ). Žemėlapyje atvaizduojamos tik šalys turinčios daugiau nei 500 regsitruotų atvejų. Šis žemėlapis iliustruoja aktyviųs koronaviruso židinius pasaulyje.

```{r, echo=FALSE}


df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T), round(max(df$value, na.rm = T)*0.9))


ggplot(df, aes(fill=value))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Procentai",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Naujų atvejų skaičiaus proc. pokytis per paskutinę parą (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```


## Pasaulis - statistika 

### Pausaulis -pagrindiniai rodikliai{.tabset .tabset-fade .tabset-pills}
#### Bendras skaičius
```{r, echo=FALSE}
df <- data_world %>%
  group_by(date, var)%>%
  summarise(value=sum(value))

max.date <- max(df$date)

ggplot(df, aes(x=date, y=value, fill=var))+
  geom_area(alpha=0.5)+
  scale_fill_manual(values=c("red", "black"),
                    labels=c("Užsikrėtimai", "Mirę") )+
  scale_x_date(breaks="1 week")+
  scale_y_continuous(labels = comma)+
  labs(title=paste0("Pasaulinis koronaviruso atvejų skaičius ir pasiskirstymas (naujausi duomenys ", max.date, ")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```

#### Užsikrėtimai (ts, top 5)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:5,]%>%
  gather(date, value, 5:ncol(.))%>%
  mutate(date=as.Date(date))

ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
  geom_line(size=1.1)+
  geom_point(size=2)+
  scale_color_brewer(palette="Set1",type = "qualitative", name="Valstybės")+
  labs(
    title="Užsikrėtimų skaičius daugiausia patvirtintų atvejų turinčiose pasaulio šalyse",
    subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
    x="Laikotarpis",
    y="Užsikrėtimų skaičius"
  )+
  scale_x_date(breaks = "1 week")+
  theme(axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))

```


#### Užsikrėtimai (ts, top 10 be Kinijos)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[2:11,]%>%
  gather(date, value, 5:ncol(.))%>%
  mutate(date=as.Date(date))

ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
  geom_line(size=1.1)+
  geom_point(size=2)+
  scale_color_brewer(palette="Paired",type = "qualitative", name="Valstybės")+
  labs(
    title="Užsikrėtimų skaičius daugiausia patvirtintų atvejų turinčiose pasaulio šalyse",
    subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
    x="Laikotarpis",
    y="Užsikrėtimų skaičius"
  )+
  scale_x_date(breaks = "1 week")+
  theme(axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))
```





### Užsikrėtimai{.tabset .tabset-fade .tabset-pills}
#### Užsikrėtimai (abs)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         date==max(.$date))%>%
  select (valstybe, value)%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius, top 20 valstybių ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Užsikrėtimai (abs, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value)%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius per paskutinę parą, top 20 valstybių ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Užsikrėtimai (/pop)
```{r, echo=FALSE}
max.date<-max(data_world$date)
pop_world <- data.frame(SOVEREIGNT=shape$SOVEREIGNT, POP_EST=shape$POP_EST, stringsAsFactors = FALSE)

df <- data_world %>%
  filter(var=="confirmed",
         date==max(.$date))%>%
  left_join(., pop_world, by=c("country"="SOVEREIGNT"))%>%
  mutate(value_pop=round(value/POP_EST*1000000,1))%>%
  top_n(.,20,value_pop)

ggplot(df,aes(x=reorder(valstybe,-value_pop), y=value_pop)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value_pop, y=value_pop), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius tenkantis 100.000 gyventojų ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Užsikrėtimai (/pop, d/d)

```{r, echo=FALSE}
max.date<-max(data_world$date)
pop_world <- data.frame(SOVEREIGNT=shape$SOVEREIGNT, POP_EST=shape$POP_EST, stringsAsFactors = FALSE)

df <- data_world %>%
  filter(var=="confirmed",
         date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
    left_join(., pop_world, by=c("country"="SOVEREIGNT"))%>%
  mutate(value_pop=round(value/POP_EST*1000000,1))%>%
  top_n(.,20,value_pop)


ggplot(df,aes(x=reorder(valstybe,-value_pop), y=value_pop)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value_pop, y=value_pop), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius tenkantis 100.000 gyventojų ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Užsikrėtimai (proc. d/d)

```{r, echo=FALSE}
max.date<-max(data_world$date)

df <- data_world %>%
  filter(var=="confirmed")%>%
    filter(date==max.date-1|date==max.date,
           value>=1)%>%
  spread(date, value)%>%
  mutate(value=round((.[,6]/.[,5]-1)*100,0))%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Užsikrėtimų per paskutinę parą pokytis, % ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Valstybė", 
       y="proc. pokytis")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Užsikrėtimai (ts, top 6)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:6,]%>%
  gather(date, value, 5:ncol(.))%>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value)))%>%
  mutate(date=as.Date(date))

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_bar(stat="identity")+
  scale_x_date(breaks="1 week")+
  labs(title=paste0('Dieninis naujų užsikrėtimų skaičius skaičius (top 6 valstybėse su daugiausia užsikrėtimų)',max.date),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius") +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~valstybe, ncol=3, 
             nrow = 2, 
             scales='free')   

```

### Mirtys {.tabset .tabset-fade .tabset-pills}

#### Mirtys (abs)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         date==max(.$date))%>%
  select (valstybe, value)%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Mirčių skaičius", 
       title=paste0("Mirčių skaičius, top 20 valstybių ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (abs, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths")%>%
  filter(date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value)%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (/pop)
```{r, echo=FALSE}
max.date<-max(data_world$date)
pop_world <- data.frame(SOVEREIGNT=shape$SOVEREIGNT, POP_EST=shape$POP_EST, stringsAsFactors = FALSE)

df <- data_world %>%
  filter(var=="deaths",
         date==max(.$date))%>%
  left_join(., pop_world, by=c("country"="SOVEREIGNT"))%>%
  mutate(value_pop=round(value/POP_EST*1000000,1))%>%
  top_n(.,20,value_pop)

ggplot(df,aes(x=reorder(valstybe,-value_pop), y=value_pop)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value_pop, y=value_pop), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Mirčių skaičius", 
       title=paste0("Mirčių skaičius tenkantis 100.000 gyventojų ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtys (/pop, d/d)

```{r, echo=FALSE}
max.date<-max(data_world$date)
pop_world <- data.frame(SOVEREIGNT=shape$SOVEREIGNT, POP_EST=shape$POP_EST, stringsAsFactors = FALSE)

df <- data_world %>%
  filter(var=="deaths")%>%
  filter(date==max.date-1|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  left_join(., pop_world, by=c("country"="SOVEREIGNT"))%>%
  mutate(value_pop=round(value/POP_EST*1000000,1))%>%
  top_n(.,20,value_pop)

ggplot(df,aes(x=reorder(valstybe,-value_pop), y=value_pop)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value_pop, y=value_pop), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius 100.000 gyventojų per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtys (proc. d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths")%>%
    filter(date==max.date-1|date==max.date,
           value>=1)

max.date<-max(df$date)

df%<>%
  spread(date, value)%>%
  na.omit()%>%
  mutate(value=round((.[,6]/.[,5]-1)*100,0))%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Mirčių per paskutinę parą pokytis, % ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Valstybė", 
       y="proc. pokytis")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtingumas (top 20)

```{r,echo=FALSE}
df <- data_world %>%
  filter(var%in%c("deaths","confirmed"),
         date==max(date))%>%
  spread(var,value)%>%
  mutate(deathrate=deaths/confirmed*100)%>%
  mutate_at(vars(deathrate),funs(round(.,2)))%>%
  arrange(deaths)%>%
  top_n(.,20, confirmed)

ggplot(df,aes(x=reorder(valstybe,-deathrate), y=deathrate, fill=valstybe))+
  geom_bar(stat='identity',
           fill="steelblue") +
  geom_text(aes(label=deathrate, y=deathrate), size=2.5, vjust=-0.5)+
  labs(x="Valstybė", y="Mirtingumas, %", title="Mirtingumas top 20 pasaulio šalių pagal mirčių skaičių", subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (ts, top 6)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:6,]%>%
  gather(date, value, 5:ncol(.))%>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value)))%>%
  mutate(date=as.Date(date))

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_bar(stat="identity")+
  scale_x_date(breaks="1 week")+
  labs(title=paste0('Dieninis mirčių skaičius skaičius (6 valstybėse su daugiausia mirčių) ',
                    max.date),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius") +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~valstybe, ncol=3, 
             nrow = 2, 
             scales='free_y')   

```

# Europos statistika

## Europa - žemėlapiai {.tabset .tabset-fade .tabset-pills}

### Užsikrėtimai (abs.)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date),)

max.date <- max(df$date)


df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(1,10, 100, 1000, 20000)

ggplot(df, aes(fill=value))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  geom_sf_label(aes(label =round(value,0)), size=2.5, fill="white" )+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```

### Užsikrėtimai (/pop.)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date),)

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*1000000)

# summary(df$value_pop)
# min(df$value_pop,na.rm = T)
# max(df$value_pop,na.rm = T)

my_breaks <- c(0.5,2.5, 10,50,250)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius tenkantis 1 mln. gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")
```


### Nauji (abs.)

```{r, echo=FALSE}
df <- data_world%>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date)-1 | date==max(date) )%>%
  spread(date, value)%>%
  mutate(diff=.[,6]-.[,5])%>%
  select(1,4,7)%>%
  rename(value=diff)

max.date <- max(data_world$date)
```

Žemiau pateikiamas naujų registruotų atvejų absoliutus skaičiaus pokytis per paskutinę parą (`r max.date-1` - `r max.date` ). Iš šio žemėlapio galima matyti, kur atsirado daugiausiai naujų atvejų.

```{r, echo=FALSE}

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T),1, 10, 100, 1000, max(df$value, na.rm = T))


ggplot(df, aes(fill=value))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  geom_sf_label(aes(label =round(value,0)), size=2.5, fill="white" )+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Naujų atvejų skaičiaus per paskutinę parą (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```


### Nauji (proc.)

```{r, echo=FALSE}
df <- data_world%>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date)-1 | date==max(date) )%>%
  spread(date, value)%>%
  mutate(diff=round((.[,6]/.[,5]-1)*100,1))%>%
  filter(.[,5]>=10)%>% # to exclude inf as result sof x/0
  select(1,4,7)%>%
  rename(value=diff)

max.date <- max(data_world$date)
```

Žemiau pateikiamas naujų registruotų atvejų skaičiaus santykinis pokytis (procentais) per paskutinę parą (`r max.date-1` - `r max.date` ). Žemėlapyje atvaizduojamos tik šalys turinčios daugiau nei 10 regsitruotų atvejų. Šis žemėlapis iliustruoja aktyviųs koronaviruso židinius pasaulyje.

```{r, echo=FALSE}


df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(round(min(df$value, na.rm = T)*1.1),1,3,10, round(max(df$value, na.rm = T)*0.9))


ggplot(df, aes(fill=value))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
    geom_sf_label(aes(label =round(value,0)), size=2.5, fill="white" )+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Naujų atvejų skaičiaus proc. pokytis per paskutinę parą (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```

## Europa - statistika

### Europa pagrindiai rodikliai{.tabset .tabset-fade .tabset-pills}

#### Bendras skaičius
```{r, echo=FALSE}
df <- data_world %>%
  filter(CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  group_by(date, var)%>%
  summarise(value=sum(value))

max.date <- max(df$date)


ggplot(df, aes(x=date, y=value, fill=var))+
  geom_area(alpha=0.5)+
  scale_fill_manual(values=c("red", "black"),
                    labels=c("Aktyvūs", "Mirę") )+
  scale_x_date(breaks="1 week")+
  scale_y_continuous(labels=comma)+
  labs(title=paste0("EEE koronaviruso atvejų skaičius ir pasiskirstymas (naujausi duomenys ", max.date, ")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```


#### Užsikrėtimai (ts, top 10)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:10,]%>%
  gather(date, value, 5:ncol(.))%>%
  mutate(date=as.Date(date))

ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
  geom_line(size=1.1)+
  geom_point(size=2)+
  scale_color_brewer(palette="Paired",type = "qualitative", name="Valstybės")+
  labs(
    title="Užsikrėtimų skaičius daugiausia patvirtintų atvejų turinčiose šalyse",
    subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
    x="Laikotarpis",
    y="Užsikrėtimų skaičius"
  )+
  scale_x_date(breaks = "1 week")+
  theme(axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))
```


### Europa - užsikrėtimai{.tabset .tabset-fade .tabset-pills}

#### Užsikrėtimai (abs)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  filter(date==max(.$date))%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų  skaičius, suminis ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Užsikrėtimai (abs, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"),
         date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Naujų Užsikrėtimų  skaičius per paskutinę dieną ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Užsikrėtimai (/pop)

```{r, echo=FALSE}
max.date<-max(data_world$date)

pop <- get_eurostat("tps00001") %>% 
  filter(time=="2019-01-01")%>%
  rename(CNTR_CODE=geo,
         pop=values)%>%
  select(CNTR_CODE, pop)

df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"),
         date==max(date))%>%
  select (valstybe, value, CNTR_CODE)%>%
  left_join(., pop, by="CNTR_CODE")%>%
  mutate(value=round((value/pop*100000),1))%>%
  select(valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius 100.000 gyventojų ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```


#### Užsikrėtimai (/pop, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-1|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value, CNTR_CODE)

pop <- get_eurostat("tps00001") %>% 
  filter(time=="2019-01-01")%>%
  rename(CNTR_CODE=geo,
         pop=values)%>%
  select(CNTR_CODE, pop)


df <- left_join(df, pop, by="CNTR_CODE")%>%
  mutate(value=round((value/pop*100000),1))%>%
  select(valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Naujų Užsikrėtimų skaičius 100.000 gyventojų per paskutinę dieną ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Užsikrėtimai (proc.)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-1|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=round((.[,6]/.[,5]-1)*100),0)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Naujų Užsikrėtimų per paskutinę dieną, % ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Valstybė", 
       y="proc. pokytis")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```


#### Užsikrėtimai (ts, top 6)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:6,]%>%
  gather(date, value, 5:ncol(.))%>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value)))%>%
  mutate(date=as.Date(date))

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_bar(stat="identity")+
  scale_x_date(breaks="1 week")+
  labs(title=paste0('Dieninis naujų užsikrėtimų skaičius skaičius (6 Europos valstybėse su daugiausia užsikrėtimų) ',
                    max.date),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius") +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~valstybe, ncol=3, 
             nrow = 2, 
             scales='free_y')   

```


### Europa - mirtys {.tabset .tabset-fade .tabset-pills}

#### Mirtys (abs)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  filter(date==max(.$date))%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (abs, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  filter(date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (/pop)

```{r, echo=FALSE}

max.date<-max(data_world$date)

df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"),
         date==max(.$date))%>%
  select (valstybe, value, CNTR_CODE)

pop <- get_eurostat("tps00001") %>% 
  filter(time=="2019-01-01")%>%
  rename(CNTR_CODE=geo,
         pop=values)%>%
  select(CNTR_CODE, pop)


df <- left_join(df, pop, by="CNTR_CODE")%>%
  mutate(value=round((value/pop*100000),1))%>%
  select(valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius 100.000 gyventojų per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```


#### Mirtys (/pop, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-1|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value, CNTR_CODE)

pop <- get_eurostat("tps00001") %>% 
  filter(time=="2019-01-01")%>%
  rename(CNTR_CODE=geo,
         pop=values)%>%
  select(CNTR_CODE, pop)


df <- left_join(df, pop, by="CNTR_CODE")%>%
  mutate(value=round((value/pop*100000),1))%>%
  select(valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius 100.000 gyventojų per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```





#### Mirtingumas

```{r,echo=FALSE}
df <- data_world %>%
  filter(var%in%c("deaths","confirmed"),
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"),
         date==max(date))%>%
  spread(var,value)%>%
  mutate(deathrate=deaths/confirmed*100)%>%
  mutate_at(vars(deathrate),funs(round(.,2)))%>%
  arrange(deaths)%>%
  top_n(.,20, confirmed)

ggplot(df,aes(x=reorder(valstybe,-deathrate), y=deathrate, fill=valstybe))+
  geom_bar(stat='identity',
           fill="steelblue") +
  geom_text(aes(label=deathrate, y=deathrate), size=2.5, vjust=-0.5)+
  labs(x="Valstybė", y="Mirtingumas, %", title="Mirtingumas EEE valstybėse", subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (proc, d/d)

```{r, echo=FALSE}
max.date<-max(data_world$date)

df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
    filter(date==max.date-1|date==max.date,
           value>=1)%>%
  spread(date, value)%>%
  na.omit()%>%
  mutate(value=round((.[,6]/.[,5]-1)*100,0))

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Mirčių per paskutinę parą pokytis, % ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Valstybė", 
       y="Proc. pokytis")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtys (ts, top 6)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:6,]%>%
  gather(date, value, 5:ncol(.))%>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value)))%>%
  mutate(date=as.Date(date))

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_bar(stat="identity")+
  scale_x_date(breaks="1 week")+
  labs(title=paste0('Dieninis mirčių skaičius skaičius (6 Europos valstybėse su daugiausia mirčių) ',
                    max.date),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius") +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~valstybe, ncol=3, 
             nrow = 2, 
             scales='free_y')   

```


# Lietuva
```{r}
df <- data_lt_country_cum %>%
  filter(date==max(date))%>%
  spread(var, values)
time_now <- format(Sys.time(), "%Y-%m-%d %H:%M")
```

Naujausiais duomenimis (`r time_now`) Lietuvoje šiuo metu yra:

* iš viso registruotų atvejų - `r df$confirmed `
* iš jų pasveiko - `r df$recovered `
* iš jų mirė - `r df$deaths`
* likęs aktyvių atvejų  skaičius - `r df$active `

## Lietuva - žemėlapiai {.tabset .tabset-fade .tabset-pills}

Deja SAM neskelbia detalios informacijos apie pacientų gyvenamąją vietą, todėl žemiau patiekti žemėlapiai remiasi mūsų surinkta informacija iš įvairių šaltinių: SAM, žiniasklaidos, ligoninių bei kitų pranešimų. Todėl skaičiuse galima paklaida.

### Užsikrėtimai (abs.)

```{r, echo=FALSE}
df <- data_lt_county_cum%>%
  filter(var=="confirmed",
         date==max(date))%>%
  left_join(.,demo_r_pjangrp, by="NUTS_ID") %>%
  mutate(values_pop=values/pop*100000)

df <- left_join(EU_shape, df, by="NUTS_ID")

min <- round(min(df$values, na.rm = T),1)
max <- round(max(df$values, na.rm = T),1)

my_breaks <- c(min,2,5, 12 ,max)

ggplot(df, aes(fill=values))+
  geom_sf()+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  geom_sf_label(aes(label =round(values,0)), size=5, fill="white" )+
  labs(title=paste0("Visi patvirinti atvejai (duomenys ",max.date,")"),
       subtitle = "Šaltinis ir skaičiavimai: Corona-Stat.lt",
       x="",
       y="")

```

### Užsikrėtimai (/pop.)
```{r, echo=FALSE}
df <- data_lt_county_cum%>%
  filter(var=="confirmed",
         date==max(date))%>%
  left_join(.,demo_r_pjangrp, by="NUTS_ID") %>%
  mutate(values_pop=values/pop*100000)


df <- left_join(EU_shape, df, by="NUTS_ID")

min <- round(min(df$values_pop, na.rm = T),1)
max <- round(max(df$values_pop, na.rm = T),1)

my_breaks <- c(min, 1.5, 2.5 ,max)

ggplot(df, aes(fill=values_pop))+
  geom_sf()+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  geom_sf_label(aes(label =round(values_pop,0)), size=5, fill="white" )+
  labs(title=paste0("Visi patvirinti atvejai (duomenys ",max.date,")"),
       subtitle = "Šaltinis ir skaičiavimai: Corona-Stat.lt",
       x="",
       y="")

```


### Aktyvūs (abs.)
```{r, echo=FALSE}
df <- data_lt_county_cum%>%
  filter(var=="active",
         date==max(date))%>%
  left_join(.,demo_r_pjangrp, by="NUTS_ID") %>%
  mutate(values_pop=values/pop*100000)


df <- left_join(EU_shape, df, by="NUTS_ID")

min <- round(min(df$values, na.rm = T),1)
max <- round(max(df$values, na.rm = T),1)

my_breaks <- c(min,2,5, 12 ,max)

ggplot(df, aes(fill=values))+
  geom_sf()+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  geom_sf_label(aes(label =round(values,0)), size=5, fill="white" )+
  labs(title=paste0("Visi patvirinti atvejai (duomenys ",max.date,")"),
       subtitle = "Šaltinis ir skaičiavimai: Corona-Stat.lt",
       x="",
       y="")

```


### Aktyvūs (/pop.)
```{r, echo=FALSE}
df <- data_lt_county_cum%>%
  filter(var=="active",
         date==max(date))%>%
  left_join(.,demo_r_pjangrp, by="NUTS_ID") %>%
  mutate(values_pop=values/pop*100000)

df <- left_join(EU_shape, df, by="NUTS_ID")

min <- round(min(df$values_pop, na.rm = T),1)
max <- round(max(df$values_pop, na.rm = T),1)

my_breaks <- c(min,1,2 ,max)

ggplot(df, aes(fill=values_pop))+
  geom_sf()+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  geom_sf_label(aes(label =round(values_pop,0)), size=5, fill="white" )+
  labs(title=paste0("Visi patvirinti atvejai (duomenys ",max.date,")"),
       subtitle = "Šaltinis ir skaičiavimai: Corona-Stat.lt",
       x="",
       y="")

```

## Lietuva - statistika {.tabset .tabset-fade .tabset-pills}
### Bendras atvejų skaičius
```{r, echo=FALSE}

df <- data_lt_county_cum%>%
  filter(var!="confirmed") %>%
  mutate(var=factor(var, levels=c("active", "recovered", "deaths")))%>%
  group_by(date, var)%>%
  summarise(values=sum(values))

max.date <- max(df$date)

ggplot(df, aes(x=date, y=values, fill=var))+
  geom_area(alpha=0.5)+
  scale_fill_manual(values=c("red", "green", "black"),
                    labels=c("Aktyvūs", "Pasveikę", "Mirę") )+
  scale_x_date(breaks="1 day")+
  labs(title=paste0("Lietuvos koronaviruso atvejų skaičius ir pasiskirstymas (naujausi duomenys ", max.date, ")"),
       subtitle = "Šaltinis ir skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```


```{r, echo=FALSE}

df <- data_lt_country%>%
  filter(var=="confirmed",
         date>="2020-02-28")


max.date <- max(df$date)

ggplot(df, aes(x=date, y=values, fill=var))+
  geom_bar( stat = "identity",
            fill="steelblue")+
  scale_x_date(breaks="1 day")+
  geom_text(aes(label=values, y=values), size=2.5, vjust=-0.5)+
  labs(title=paste0("Naujų atvejų skaičius (naujausi duomenys ", max.date, ")"),
       subtitle = "Šaltinis ir skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```

## Ištyrimai

Žemiau lentelėje pateikiamas santykis tarp atliktų testų bei stebimų asmenų. Duomenų šaltinis SAM. Deja neturime pilnos informacijos visoms dienoms, neaišku, kiek iš atliktų testų yra atlikti pakartotiniai testai, taip pat abejonių kelia paskutines dienas nedidėjęs stebimų asmenų (kurie potencialiai turėjo kontaktą su koronaviruso nešiotojais) skaičius. Todėl tikėtina, jog ypatingai paskutinių dienų ištyrimų statistika yra klaidinga (per daug optimistinė).

```{r}
data_lt %>%
  na.omit()%>%
  mutate(tested_perc=round(tested_total/observed*100,1))%>%
  select(date,tested_total, observed, tested_perc)%>%
  rename(Data=date,
         "Atlitka testų"=tested_total,
         "Stebimų asm. skaičius"=observed,
         "Ištyrimų proc."=tested_perc)%>%
  kable(escape = F,row.names = FALSE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), 
                full_width = F, 
                position = "center")

```

Lietuvoje testuojamų asmenų skaičius nėra didelis (palyginus su Latvija ar Estija) dėl ypatingai mažo turimų reagentų skaičiaus. Todėl 2020-03-21/22 dienomis netgi buvo [apribotas mėginių ėmimas Kauno ir Klaipėdos mobiliame punkte. 2020-02-21 Lietuvoje buvo apie 1300 reagentų (2020-02-21 atlitki 384 testai).](https://www.15min.lt/naujiena/aktualu/lietuva/likus-700-reagentu-gali-buti-tiriami-ne-visi-eminiai-is-mobiliosios-patikros-punktu-56-1293308). 

```{r}
pop <- demo_r_pjangrp%>%
  filter(NUTS_ID %in% c("LT", "LV", "EE"))%>%
  select(NUTS_ID, pop)%>%
  data.frame()

lt <- data_lt %>%
  select(date, tested_total)%>%
  rename(tested_total_lt=tested_total)

lv <- data_lv %>%
  select(date, tested_total)%>%
  rename(tested_total_lv=tested_total)

ee <- data_ee %>%
  select(date, tested_total)%>%
  rename(tested_total_ee=tested_total)

df <- merge(lt,lv)%>% merge(.,ee) %>%
  mutate(
    tested_total_lt_p=tested_total_lt/pop[3,2]*1000,
    tested_total_lv_p=tested_total_lv/pop[2,2]*1000,
    tested_total_ee_p=tested_total_ee/pop[1,2]*1000
  )%>%
  gather(var, values, 2:7)%>%
  mutate(case=rep(c("Skaičius", "Skaičius tenkantis 1000 gyventojų"), each=nrow(.)/2),
         geo=rep(c("Lietuva", "Latvija", "Estija"), each=nrow(lt), times=2))

ggplot(df, aes(date, values, col=geo))+
  geom_line(size=1.1)+
  geom_point(size=2)+
  scale_color_brewer(palette="Set1",type = "qualitative", name="Valstybės")+
  labs(
    title="Testavimo apimtys Baltijos šalyse",
    subtitle="Šaltinis ir skaičiavimai: Corona-Stat.lt",
    x="Laikotarpis",
    y="Skaičius"
  )+
  scale_x_date(breaks = "2 day")+
  theme(legend.position = "bottom",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~case, scales = "free_y")
```

## Rizikos statistika

## Medicinos pajėgumai




# Ekonominiai rodikliai
Kai tik atsiras statistiniai rodikliai, pradėsije juos pildyti šioje skiltyje. Šiuo metu tiek Lietuvoje, tiek visame pasaulyje ekonomistai, ekonometrikai, analitikai ir kas tik netingi išreiškia koiekybines prognozes. Deja jos visos remiasi išimtinai prielaidomis, o ne faktais. Kiekybiškai įvertinti koronaviruso sukeliamos pasaulinės recesijos šiuo metu dar nėra įmanoma. 

## VMI paskelbtas įmonių sąrašas {.tabset .tabset-fade .tabset-pills}
Nežinau ar dėl to, jog mes (ir tikiu ne tik mes) palaidome robotukus nuskaityti vmi.lt tinklapyje esančią informaciją, 2020-03-23 VMI paviešino įmonių, kurios mokesčiams sumokėti arba mokestinės paskolos sutarčiai, be palūkanų sudaryti, turės du mėnesius, [sąrašą](https://www.vmi.lt/cms/informacija-verslui-del-covid-19). Saraše - `r nrow(vmi)` įmonės. Pagal šį sudarytą sąrašą galiem vertinti, kokios įmonės (VMI supratimu) susidurs su ekonominiais sunkumais. 

###

```{r}
df <- vmi %>%
  select(`EV sekcija`)%>%
  group_by(`EV sekcija`)%>%
  summarise(Skaičius=n())%>%
  arrange(desc(Skaičius))

ggplot(df, aes(reorder(`EV sekcija`, Skaičius), Skaičius))+
  geom_bar(stat = "identity",
           fill="steelblue")+
  coord_flip()+
  geom_text(aes(label=Skaičius, y=Skaičius), size=2.5, hjust=-0.1)+
  labs(title="VMI įmonių sąrašas pagal ekonominės veiklos sekcijas", 
       subtitle="Šaltinis: vmi.lt, skaičiavimai: Corona-Stat.lt",
       x="EV skyrius", y="Įmonių skaičius")+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))



```

###
  
```{r}
df <- vmi %>%
  select(`EV skyrius`)%>%
  group_by(`EV skyrius`)%>%
  summarise(Skaičius=n())%>%
  arrange(desc(Skaičius))

ggplot(df, aes(reorder(`EV skyrius`, Skaičius), Skaičius))+
  geom_bar(stat = "identity",
           fill="steelblue")+
  coord_flip()+
  geom_text(aes(label=Skaičius, y=Skaičius), size=2.5, hjust=-0.1)+
  labs(title="VMI įmonių sąrašas pagal ekonominės veiklos skyrius", 
       subtitle="Šaltinis: vmi.lt, skaičiavimai: Corona-Stat.lt",
       x="EV skyrius", y="Įmonių skaičius")+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))



```

###

```{r}
df <- vmi %>%
  select(`JA teisinė forma`)%>%
  group_by(`JA teisinė forma`)%>%
  summarise(Skaičius=n())%>%
  arrange(desc(Skaičius))

ggplot(df, aes(reorder(`JA teisinė forma`, Skaičius), Skaičius))+
  geom_bar(stat = "identity",
           fill="steelblue")+
  coord_flip()+
  geom_text(aes(label=Skaičius, y=Skaičius), size=2.5, hjust=-0.1)+
  labs(title="VMI įmonių sąrašas pagal įmonių teisinę formą", 
       subtitle="Šaltinis: vmi.lt, skaičiavimai: Corona-Stat.lt",
       x="Teisinė forma", y="Įmonių skaičius")+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))

```

Artimiausiu metu bus pateikta daugiau įžvalgų iš VMI duomenų...




## Lietuva{.tabset .tabset-fade .tabset-pills}
### BVP
### Pramonės produkcija
### Užsienio prekyba
### Mažmeninė preyba
### Infliacija
### Kreditai
### Užimtumas / nedarbas

## Pagrindinės ES šalys{.tabset .tabset-fade .tabset-pills}
### BVP
### Pramonės produkcija
### Užsienio prekyba
### Mažmeninė preyba
### Infliacija
### Kreditai
### Užimtumas / nedarbas


# Prognozės
## Sergamumo statistikos prognozės

Experimentiniai grafikai:

```{r}

df <- data_world %>%
  filter(var=="confirmed",
         value>=100)%>%
  group_by(valstybe)%>%
  arrange(date)%>%
  mutate(index = value/value[1],
         time_0=seq_along(along.with = date))%>%
  filter(
    # CNTR_CODE %in% c("CN", "IT", "DE", "KR", "ES", "IR", "JP", "EE"),
    time_0<=40)


ggplot(df, aes(time_0, value,  group=valstybe))+
  geom_line()+
  scale_y_continuous(trans = log2_trans())+
  scale_color_brewer(palette="Set1",type = "qualitative", name="Valstybės")+
  labs(title="Registruotų atvejų skaičiaus raida nuo momento, kai šalyje pasiekta 100 atvejų",
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Dienos 0+t",
       y="Skaičius (log2)")+
  theme(legend.title=element_blank(),
        legend.position="left",
        axis.text.x = element_text(angle = 45, hjust = 1))


```


Užsikrėtimų pokytis paskelbus karantiną

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO"))%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  filter(valstybe %in% c(.$valstybe[1:5], "Estija", "Latvija", "Lenkija", "Lietuva"))%>%
  gather(date, value, 5:ncol(.))%>%
  mutate(date=as.Date(date)) %>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value))) %>%
  select (valstybe,date, diff)

# čia reikia sukurti atskirą DF, geriausia google sheete ir importuot, nes reikia visoms šalims

dff <- data.frame(valstybe=c("Airija", "Austrija", "Belgija", "Čekija", "Danija", 
                             "Estija", "Graikija", "Ispanija", "Islandija", "Italija", "Kipras", "Kroatija", "Latvija", "Lenkija", "Lietuva", "Liuksemburgas", "Nyderlandai", "Norvegija",
                             "Portugalija", "Prancūzija", "Rumunija", "Slovakija", "Slovėnija", "Suomija", "Vengrija", "Vokietija"),
                  diena=c("2020-03-13", "2020-03-11","2020-03-18", "2020-03-16","2020-03-13", "2020-03-12","2020-03-16", "2020-03-14","2020-03-16", "2020-03-11","2020-03-11",
                          "2020-03-13","2020-03-17", "2020-03-11","2020-03-16", "2020-03-13","2020-03-11", "2020-03-12","2020-03-12", "2020-03-16","2020-03-16", "2020-03-16","2020-03-20", "2020-03-16"
                          ,"2020-03-13", "2020-03-15"))%>%
  mutate(diena=as.Date(as.character(diena)))

df <- left_join(df,dff)

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_area(alpha=0.5, color="darkred", fill="red")+
  scale_x_date()+
  labs(title=paste0('Covid-19 Užsikrėtimų pokytis TOP 5 ir Baltijos valstybėse įvedus karantiną ',
                    max.date), 
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt", 
       x="Data", 
       y="Užsikrėtimų skaičius")+
  facet_wrap(~valstybe, ncol=3, scales='free_y')+
  geom_vline(data = df, mapping = aes(xintercept = diena), color="blue" , size=1.1)
```

![https://xkcd.com/2281/](https://imgs.xkcd.com/comics/coronavirus_research.png)

## Ekonominės prognozės

![comic: https://xkcd.com/2280/](https://imgs.xkcd.com/comics/2010_and_2020.png )
