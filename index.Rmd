---
title: "Coronavirus COVID-19 (2019-nCoV) statistics in Baltic states"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    fig_width: 16
    fig_height: 9
    fig_caption: true
    theme: flatly
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, error = TRUE, warning = FALSE, message = FALSE)
```

```{r, include=FALSE}
# paketai kurie reikalingi kodo veikimui
if(!require("magrittr")) install.packages("magrittr"); library("magrittr")
if(!require("lubridate")) install.packages("lubridate"); library("lubridate")
if(!require("tidyverse")) install.packages("tidyverse"); library("tidyverse")
if(!require("gridExtra")) install.packages("gridExtra"); library("gridExtra")
if(!require("kableExtra")) install.packages("kableExtra"); library("kableExtra")
if(!require("RColorBrewer")) install.packages("RColorBrewer"); library("RColorBrewer")
if(!require("scales")) install.packages("scales"); library("scales")
if(!require("rgdal")) install.packages("rgdal"); library("rgdal")
if(!require("sf")) install.packages("sf"); library("sf")
if(!require("gsheet")) install.packages("gsheet"); library("gsheet")
if(!require("osmdata")) install.packages("osmdata")
if(!require("ggmap")) install.packages("ggmap")
```

```{r, include=FALSE}
# duomenų importas
# duomenų šaltinis: Rhttps://github.com/CSSEGISandData/COVID-19
# 2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by Johns Hopkins CSSE

data_confirmed <-read.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv', stringsAsFactors = FALSE)
data_deaths <-read.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv', stringsAsFactors = FALSE)
data_recovered <-read.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Recovered.csv', stringsAsFactors = FALSE)

```

```{r, include=FALSE}
# todo
# šalies pakeitimai prieš summary, arba reikia daryti ant pavienių datasetų po importo,
# arba pirma apjungti DS ir tada
# reikia papildomo žingsnio verifikavimui (vidiniam) ar  šalys iš  Hopkinso ir žemėlapių atitinka, nes atsiradus naujoms šalims reikės rankutėmis koreguot... hopkins naudoja WHO šlaių pavadinimus, žemėlapiai ne...


# data$country[data$country=="Congo (Kinshasa)"] <- "Democratic Republic of the Congo"
# data$country[data$country=="Cote d'Ivoire"] <- "Ivory Coast"
# data$country[data$country=="French Guiana"] <- "France"
# data$country[data$country=="Martinique"] <- "France"
# data$country[data$country=="Reunion"] <- "France"
# data$country[data$country=="Holy See"] <- "Vatican"
# data$country[data$country=="Korea, South"] <- "South Korea"
# data$country[data$country=="North Macedonia"] <- "Macedonia"
# data$country[data$country=="Serbia"] <- "Republic of Serbia"
# data$country[data$country=="US"] <- "United States of America"


```

```{r, include=FALSE}
# todo
# reikia importą zipo ir failo paėmimą iš zipo padaryt, nes dabar iš working directory ima

# INFO:
# https://www.naturalearthdata.com/downloads/50m-cultural-vectors/50m-admin-0-countries-2

# URL <- "https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/ne_50m_admin_0_sovereignty.zip"
# download.file(url=URL, destfile ="ne_50m_admin_0_sovereignty.zip", method = "auto")
# unzip("ne_50m_admin_0_sovereignty.zip", exdir = "./")
#countries <- readOGR(dsn="ne_50m_admin_0_sovereignty.shp",
#                             encoding = "utf-8",
#                             use_iconv = T,
#                             verbose = FALSE,
#                     stringsAsFactors = FALSE)
# countries <- st_as_sf(countries)
# ggplot(countries)+ geom_sf()


```

```{r, include=FALSE}


cleaning_data <- function(data) {
        data %<>% select(-c(Province.State, Lat, Long)) %>% rename(country=Country.Region)
        data %<>% gather(key=date, value=count, -country)
        data %<>% mutate(date=date %>%substr(2,8) %>% mdy())
        data %<>% group_by(country, date) %>% summarise(count=sum(count)) %>% as.data.frame()
}

```



```{r, include=FALSE}

data_confirmed %<>% cleaning_data() %>% rename(confirmed=count)
data_deaths %<>% cleaning_data() %>% rename(deaths=count)
data_recovered %<>% cleaning_data( )%>% rename(recovered=count)

data <- data_confirmed%>% 
        merge(data_deaths)%>% 
        merge(data_recovered)%>%
        mutate(confirmed_rest=confirmed-deaths-recovered) %>%
        gather(key=var, value=value, -c(country, date)) %>%
        mutate(var=factor(var, levels=c("confirmed", "confirmed_rest", "recovered", "deaths")))

```
# Įvadas
Lorre ipsum

# Duomenys
```{r, include=FALSE}
# Duomenys apie Corona atvejus iš spaudos pranešimų
# corona_gs_sheet <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1l9HM2hIjLFA-SZy_kO8b8B5Ddr0hfVZrmx2Yb1n1feg/edit#gid=0")

# Agreguojame atvejus vienos dienos lygmeniu
# corona_gs_sheet %>% group_by(date, var) %>% summarize(value = sum(Value))
# corona_gs_sheet %>% group_by(date, var, county_2) %>% summarize(value = sum(Value))

```

# Pasaulinė statistika

## Bendra statistika
```{r, echo=FALSE}
data_world<- data %>%
        group_by(date, var)%>%
        summarise(value=sum(value))%>%
        filter(var!="confirmed")

max.date <- max(data$date)

ggplot(data_world, aes(x=date, y=value, fill=var))+
        geom_area(alpha=0.5)+
        scale_fill_manual(values=c("red", "green", "black"))+ 
        scale_x_date(breaks="1 week")+
        scale_y_continuous(breaks =pretty_breaks())+
        labs(title=paste0("COVID-19 (last update ", max.date,")"),
             subtitle = "Source: 2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by Johns Hopkins CSSE",
             x="Date",
             y="Count")+
        theme(legend.title=element_blank(),
              legend.position='bottom',
              axis.text.x = element_text(angle = 45, hjust = 1))

```

## Top 10 šalių

## Žemėlapis


# Europos statistika {.tabset .tabset-fade .tabset-pills}

## Country A

You can also embed plots, for example:

```{r, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

## Country B

You can also embed plots, for example:

```{r , echo=FALSE}
plot(pressure, type="l")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


# Lietuvos statistika
## Bendra statistika
## Žemėlapis

# Prognozės
Kas turite kokių pasiūlymų, kaip prognozuoti užsikrėtimų, mirčių statistika?
