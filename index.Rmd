---
title: "Coronavirus COVID-19 (2019-nCoV) statistics in Baltic states"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    fig_width: 16
    fig_height: 9
    fig_caption: true
    theme: flatly
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, error = TRUE, warning = FALSE, message = FALSE)
```

```{r, include=FALSE}
# loading packets that are needed for running the .Rmd 
source("./scripts/loading_R_packets.R")
```

```{r, include=FALSE}
# importing JHCSSE and LT data, data preparation
source("./scripts/data_import_preparation_word.R")
source("./scripts/data_import_preparation_word_map.R")
source("./scripts/data_import_preparation_LT.R")
```


```{r, include=FALSE}
# todo
# reikia importą zipo ir failo paėmimą iš zipo padaryt, nes dabar iš working directory ima

# INFO:
# https://www.naturalearthdata.com/downloads/50m-cultural-vectors/50m-admin-0-countries-2

# URL <- "https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/ne_50m_admin_0_sovereignty.zip"
# download.file(url=URL, destfile ="./data/ne_50m_admin_0_sovereignty.zip", method = "auto")
# unzip("./data/ne_50m_admin_0_sovereignty.zip", exdir = "./data/")
# countries <- readOGR(dsn="./data/ne_50m_admin_0_sovereignty.shp",
#                              encoding = "utf-8",
#                              use_iconv = T,
#                              verbose = FALSE,
#                      stringsAsFactors = FALSE)
#  countries <- st_as_sf(countries)
#  ggplot(countries)+ geom_sf()

```



# Įvadas
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam convallis mauris id commodo rutrum. Ut ultrices, nisl non maximus pulvinar, risus risus vehicula nulla, ullamcorper lacinia orci ligula ac neque. Suspendisse lacinia, erat vitae tincidunt euismod, arcu justo viverra enim, vel maximus orci ipsum eu libero. Phasellus bibendum ullamcorper ligula. Nunc mauris nulla, dictum porttitor vehicula sed, tincidunt non dolor. Etiam a porta mi, non scelerisque enim. Etiam vel massa tempus, blandit erat eget, pulvinar augue. Cras facilisis justo vel urna egestas consequat. Donec rhoncus tincidunt malesuada. Fusce sit amet volutpat quam. Integer faucibus, turpis id efficitur tempor, ante lorem commodo tortor, et eleifend metus odio iaculis orci. Duis nisl nulla, semper et arcu et, rutrum interdum ipsum. 

# Duomenys
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam convallis mauris id commodo rutrum. Ut ultrices, nisl non maximus pulvinar, risus risus vehicula nulla, ullamcorper lacinia orci ligula ac neque. Suspendisse lacinia, erat vitae tincidunt euismod, arcu justo viverra enim, vel maximus orci ipsum eu libero. Phasellus bibendum ullamcorper ligula. Nunc mauris nulla, dictum porttitor vehicula sed, tincidunt non dolor. Etiam a porta mi, non scelerisque enim. Etiam vel massa tempus, blandit erat eget, pulvinar augue. Cras facilisis justo vel urna egestas consequat. Donec rhoncus tincidunt malesuada. Fusce sit amet volutpat quam. Integer faucibus, turpis id efficitur tempor, ante lorem commodo tortor, et eleifend metus odio iaculis orci. Duis nisl nulla, semper et arcu et, rutrum interdum ipsum. 

# Pasaulinė statistika {.tabset .tabset-fade .tabset-pills}
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam convallis mauris id commodo rutrum. Ut ultrices, nisl non maximus pulvinar, risus risus vehicula nulla, ullamcorper lacinia orci ligula ac neque. Suspendisse lacinia, erat vitae tincidunt euismod, arcu justo viverra enim, vel maximus orci ipsum eu libero. Phasellus bibendum ullamcorper ligula. Nunc mauris nulla, dictum porttitor vehicula sed, tincidunt non dolor. Etiam a porta mi, non scelerisque enim. Etiam vel massa tempus, blandit erat eget, pulvinar augue. Cras facilisis justo vel urna egestas consequat. Donec rhoncus tincidunt malesuada. Fusce sit amet volutpat quam. Integer faucibus, turpis id efficitur tempor, ante lorem commodo tortor, et eleifend metus odio iaculis orci. Duis nisl nulla, semper et arcu et, rutrum interdum ipsum. 

## Žemėlapis{.tabset .tabset-fade .tabset-pills}
### Visi patvirtinti
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="confirmed",
         date==max(date))
max.date <- max(df$date)

shape <- readOGR("./shape_files/ne_50m_admin_0_sovereignty.shp",
                 encoding = "utf-8",
                 use_iconv = T,
                 verbose = FALSE,
                 stringsAsFactors = FALSE)%>%
  st_as_sf(countries)%>% 
  select(SOVEREIGNT, POP_EST)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

ggplot(df, aes(fill=value))+
  geom_sf()+
  scale_fill_gradientn(colours=rev(brewer.pal(11,"RdYlBu")),
                       name="Susirgimai",
                       na.value = "grey100",
                       values = rescale(seq(1, 100000, length.out = 11)))+
  labs(title=paste0("Suminis korona virusu apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE Skaičiavimai: corona-stat.lt")

```

### Visi patvirtinti /100.000 pop
```{r, echo=FALSE}
df <- read.csv("./data/data_world_map.csv",
               header = TRUE,
               stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))%>%
  filter(var=="confirmed",
         date==max(date))

max.date <- max(df$date)

shape <- readOGR("./shape_files/ne_50m_admin_0_sovereignty.shp",
                 encoding = "utf-8",
                 use_iconv = T,
                 verbose = FALSE,
                 stringsAsFactors = FALSE)%>%
  st_as_sf(countries)%>% 
  select(SOVEREIGNT, POP_EST)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*100000)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  scale_fill_gradientn(colours=rev(brewer.pal(6,"RdYlBu")),
                       name="Susirgimai\n/100.000 gyventojų",
                       na.value = "grey100", 
                       values =  rescale(seq(0, 400, length.out = 6)))+
  labs(title=paste0("Apsikrėtusiųjų skaičius tenkantis 100.000 gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE Skaičiavimai: corona-stat.lt")
  ```






## Kita statistika {.tabset .tabset-fade .tabset-pills}
```{r, echo=FALSE}
df <- read.csv("./data/data_world.csv",
                       stringsAsFactors = FALSE)%>%
        mutate(date=as.Date(date))%>%
        mutate(var=factor(var, levels=c("active", "recovered", "deaths")))%>%
        filter(var!="confirmed")%>%
        group_by(date, var)%>%
        summarise(value=sum(value))

max.date <- max(df$date)


ggplot(df, aes(x=date, y=value, fill=var))+
        geom_area(alpha=0.5)+
        scale_fill_manual(values=c("red", "green", "black"))+ 
        scale_x_date(breaks="1 week")+
        scale_y_continuous(breaks =pretty_breaks())+
        labs(title=paste0("COVID-19 (last update ", max.date,")"),
             subtitle = "Source: 2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by Johns Hopkins CSSE",
             x="Date",
             y="Count")+
        theme(legend.title=element_blank(),
              legend.position='bottom',
              axis.text.x = element_text(angle = 45, hjust = 1))
```



# Europos statistika {.tabset .tabset-fade .tabset-pills}
## Žemėlapis {.tabset .tabset-fade .tabset-pills}
### Žemėlapis 1
```{r, echo=FALSE}
library(RColorBrewer)
df <- read.csv("./data/data_world_map.csv",
                           header = TRUE,
                           stringsAsFactors = FALSE)%>%
        mutate(date=as.Date(date))%>%
    filter(var=="confirmed",
           date==max(date))

shape <- get_eurostat_geospatial(output_class = "sf", resolution = "20", nuts_level = "0")

df <- left_join(shape, df, by="CNTR_CODE")

ggplot(df, aes(fill=value))+
  geom_sf()+
 scale_fill_gradientn(colours=rev(brewer.pal(10,"Spectral")))+
   labs(title=paste0("Suminis korona virusu apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
             subtitle = "Šaltinis:JHCSSE Skaičiavimai: corona-stat.lt")+
  xlim(c(-23,29))+
  ylim(c(35,70))
```

##Statistika
###Naujų užsikrėtimų skaičius
```{r, echo=FALSE}
data_world <- read.csv("./data/data_world.csv",
                       stringsAsFactors = FALSE)%>%
        mutate(date=as.Date(date))%>%
        mutate(var=factor(var, levels=c("active", "recovered", "deaths", "confirmed")))



data_world <- data_world%>%filter(valstybe%in%c("Airija","Lietuva","Austrija","Liuksemburgas","Belgija", "Malta" ,"Bulgarija","Nyderlandai","Čekija","Portugalija","Danija",
                                                "Prancūzija","Estija","Rumunija","Graikija","Slovakija", "Ispanija","Slovėnija","Italija","Suomija","Kipras",
                                                "Švedija","Kroatija","Vengrija","Latvija","Vokietija","Lenkija"), var=="confirmed" )
date1<-max(data_world$date)

data_world <- data_world%>%
        filter(date==date1-3|date==date1) %>%
        group_by(valstybe) %>%
        mutate(diff = value - lag(value, default = first(value))) %>%
        filter(date!=today()-3 & diff!=0)%>%
        select (valstybe, diff)

plotset <- theme(
        axis.title.x = element_text(size = 20.5),
        axis.title.y = element_text(size = 20.5))


ggplot(data_world,aes(x=reorder(valstybe,diff), y=diff, fill=valstybe, group=valstybe)) +
        geom_bar(stat='identity') +
        geom_text(aes(label=diff, y=diff), size=6, vjust=-0.75) +
        labs(x="Valstybė", y="Susirgimų skaičius", title=paste0("Susirgimų per paskutines 3d. skaičius ", date1+1, " duomenimis"),
             subtitle="Šaltinis: www.corona-stat.lt" )+
        scale_fill_discrete(name='Valstybė', labels=data_world$valstybe) +
        theme(legend.title=element_blank(),
              legend.position='none',
              axis.text=element_text(size=15),
              axis.text.x=element_text(angle=45, hjust=1))+
        plotset

```

###Naujų užsikrėtimų skaičius 100tūkst.gyventojų
```{r, echo=FALSE}
pop <- get_eurostat("tps00001")
pop$time <- as.character(pop$time)
pop<-pop%>% filter(time=="2019-01-01")%>%
        mutate(valstybe=countrycode(geo, origin = "eurostat", destination =  "cldr.short.lt",nomatch = NULL ))%>%
        select(valstybe,values) %>% 
        right_join(data_world, pop, by="valstybe")%>%
        na.omit()%>%
        mutate(reiksme=(diff/(values/100000)))%>%
        select(valstybe, reiksme)%>%
        mutate(reiksme=round(reiksme,3))

ggplot(pop,aes(x=reorder(valstybe,reiksme), y=reiksme, fill=valstybe, group=valstybe)) +
        geom_bar(stat='identity') +
        geom_text(aes(label=reiksme, y=reiksme), size=5, vjust=-0.75)+
        labs(x="Valstybė", y="Susirgimų skaičius", title=paste0("Susirgimų skaičius 100.000 gyventojų per paskutines 3d. ", date1+1, " duomenimis"),
             subtitle="Šaltinis: www.corona-stat.lt" )+
        scale_fill_discrete(name='Valstybė', labels=data_world$valstybe) +
        theme(legend.title=element_blank(),
              legend.position='none',
              axis.text=element_text(size=15),
              axis.text.x=element_text(angle=45, hjust=1))+
        plotset
```
# Lietuva {.tabset .tabset-fade .tabset-pills}
## Žemėlapis
```{r, echo=FALSE}
library(RColorBrewer)
df <- read.csv("./data/data_lt_county_cum.csv",
                           header = TRUE,
                           stringsAsFactors = FALSE)%>%
        mutate(date=as.Date(date))%>%
    filter(var=="confirmed",
           date==max(date))

shape <- get_eurostat_geospatial(output_class = "sf", resolution = "60", nuts_level = "3")%>%
  filter(CNTR_CODE=="LT")

df <- left_join(shape, df, by="NUTS_ID")

ggplot(df, aes(fill=values))+
  geom_sf()+
 scale_fill_gradientn(colours=rev(brewer.pal(10,"Spectral")))+
   labs(title=paste0("Suminis korona virusu apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
             subtitle = "Šaltinis: corona-stat.lt")
```


# Ekonomika {.tabset .tabset-fade .tabset-pills}
## BVP
## Pramonės produkcija
## Užsienio prekyba
## Mažmeninė preyba
## Infliacija
## Kreditai
## Užimtumas / nedarbas

# Prognozės

