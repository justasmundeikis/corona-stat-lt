---
title: "Corona-Stat.lt"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    fig_width: 9
    fig_height: 6
    fig_caption: true
    theme: flatly
editor_options:
  chunk_output_type: console
---
![](figures/corona-stat-logo.png)
**Naujausias update: `r format(Sys.time(), "%Y-%m-%d %H:%M")`**

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, collapse = TRUE, error = TRUE, warning = FALSE, message = FALSE)
```

```{r, include=FALSE}
# loading packets that are needed for running the .Rmd
source("./scripts/loading_R_packets.R")
```

```{r, include=FALSE}
# importing JHCSSE and LT data, data preparation
dir.create("./data/")
source("./scripts/data_import_preparation_world.R")
source("./scripts/data_import_GS.R")
# source("./scripts/vmi.R")
```

```{r, include=FALSE}
# loading shape files
#source: 
shape <- readOGR("./shape_files/ne_50m_admin_0_sovereignty.shp",
                 encoding = "utf-8",
                 use_iconv = T,
                 verbose = FALSE,
                 stringsAsFactors = FALSE)%>%
  st_as_sf(countries)%>%
  select(SOVEREIGNT, POP_EST)%>%
  mutate(POP_EST=as.numeric(POP_EST))

# source: Eurostat
EU_shape <- get_eurostat_geospatial(output_class = "sf", resolution = "60", nuts_level = "3")%>%
  filter(CNTR_CODE=="LT")
```


```{r, include= FALSE}

demo_r_pjangrp <- get_eurostat("demo_r_pjangrp3", 
                               stringsAsFactors = FALSE, 
                               filters = list(age="TOTAL",
                                              sex="T",
                                              time="2019"))%>%
  rename(NUTS_ID=geo,
         pop=values)
```


```{r, include=FALSE}

data_world <- read.csv("./data/data_world.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed", "deaths")))

data_lt_country <- read.csv("./data/data_lt_country.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed","active", "recovered", "deaths")))

data_lt_country_cum <- read.csv("./data/data_lt_country_cum.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed","active", "recovered", "deaths")))

data_lt_county <- read.csv("./data/data_lt_county.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed","active", "recovered", "deaths")))

data_lt_county_cum <- read.csv("./data/data_lt_county_cum.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date),
         var=factor(var, levels=c("confirmed","active", "recovered", "deaths")))

data_lt <- read.csv("./data/data_lt.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))

data_lv <- read.csv("./data/data_lv.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))

data_ee <- read.csv("./data/data_ee.csv",header = TRUE,stringsAsFactors = FALSE)%>%
  mutate(date=as.Date(date))

vmi <- read_excel("./data/vmi.xlsx")%>%
  na.omit()


table_risk_agg <- read.csv("./data/osp/table_risk_agg.csv", stringsAsFactors = FALSE)
table_risk_age_group <- read.csv("./data/osp/table_risk_age_group.csv", stringsAsFactors = FALSE)

```

# Info

Koronos virusas (SARS-CoV-2) pirmą kartą užfiksuotas lapkričio 17 d. Kinijoje, visgi Kinija ilgą laiką neigė ir slėpė informaciją apie viruso plitimą. Sausio pabaigoje užfiksuoti pirmieji atvejai Europoje. Lietuvoje pirmą kartą virusas diagnozuotas vasario 28 d. Po pradinės ramybės, sparčiai pradėjus daugėti naujiems atvejams, pradėjo didėti ir visuomenės bei žiniasklaidos dėmesys šiam virusui ir jo paplitimui šalyje. Nors internete yra įvairų statistikų, kuriose pateikiama globali statistika, mūsų nuomone Lietuvoje reikėjo tinklapio, kuriame greitai būtų galima įvertinti atrinktą svarbiausią statistiką, ne tik apie pasaulinę (europinę) statistiką, bet ir apie paplitimą Lietuvoje bei kitus svarbius faktus.

**Šį puslapį rengia**

* Arminte Globytė (VU EVAF)
* Justas Mundeikis (Lithuanian-Economy.net)
* Rokas Klydžia
* Tomas Dzedulionis (VU EVAF)

Aptikus netikslumų arba turint klausimų bei pasiūlymų galite kreiptis el. paštu: corona-stat@protonmail.com

**Tinklapio aktualumas**

* statistika:
* pasaulinė statistika (JHCSSE) atnaujinama kartą per parą (~03:00)
* Lietuvos statistika atnaujinama kelis kartus dienos eigoje
* grafikai / lentelės ataujinami - 09:00, 12:00, 15:00, 18:00, 21:00 Lietuvos laiku
* tekstas šiuo metu dar pildomas, atnaujinimus planuojame kartą per savaitę

**Duomenys**

Šiame tinklapyje pateikiami apibendrinti statistiniai rodikliai, kurie remiasi 

* John Hopkins CSSE ([link](https://github.com/CSSEGISandData/COVID-19)) renkama pasauline statistika. Pastaba: nuo 2020-03-24 dienos JHSCSSE nebeteikia *pasveikusiųjų* statistikos, dėl mažo tokio rodiklio patikimumo, atitinkamai pasikeitė ir šiame tinklapyje pristatoma statistika.
* Mūsų komandos renkama Lietuvos statistika
* Kitais šaltiniais - Eurostat, Lietuvos statistikos departamento, Lietuvos Banko bei kt.

**PERSPĖJIMAS**

Tinklapis vis dar tebėra rengiamas, todėl galimi laikini sutrkimai. Tinklapio "baigtinė" versija planuojama atsiras - 2020-03-22.

# Pasaulinė statistika
Žemiau pateikiama atrinkta statistika, kuri leidžia geriau įvertinti coronos viruso paplitimą pasaulyje.

## Pasaulis - žemėlapiai{.tabset .tabset-fade .tabset-pills}
### Užsikrėtimai (abs.)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         date==max(date))

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T),10, 100, 1000, 10000, max(df$value, na.rm = T))

ggplot(df, aes(fill=value))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```

### Užsikrėtimai (/pop.)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         date==max(date))

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*1000000)

# summary(df$value_pop)
# min(df$value_pop,na.rm = T)
# max(df$value_pop,na.rm = T)

my_breaks <- c(0.1,1,10,100,1500,20000)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius tenkantis 1 mln. gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")
```

### Nauji (abs.)
```{r, echo=FALSE}
df <- data_world%>%
  filter(var=="confirmed",
         date==max(date)-1 | date==max(date) )%>%
  spread(date, value)%>%
  mutate(diff=.[,6]-.[,5])%>%
  select(1,4,7)%>%
  rename(value=diff)

max.date <- max(data_world$date)
```

Žemiau pateikiamas naujų registruotų atvejų absoliutus skaičiaus pokytis per paskutinę parą (`r max.date-1` - `r max.date`). Iš šio žemėlapio galima matyti, kur atsirado daugiausiai naujų atvejų.

```{r, echo=FALSE}

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T),1, 10, 100, 1000, max(df$value, na.rm = T))


ggplot(df, aes(fill=value))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Naujų atvejų skaičiaus pokytis per paskutinę parą (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```


### Nauji (proc.)
```{r, echo=FALSE}
df <- data_world%>%
  filter(var=="confirmed",
         date==max(date)-1|date==max(date))%>%
  spread(date, value)%>%
  mutate(diff=round((.[,6]/.[,5]-1)*100,1))%>%
  filter(.[,5]>=500)%>% # to exclude inf as result sof x/0
  select(1,4,7)%>%
  rename(value=diff)

max.date <- max(data_world$date)
```

Žemiau pateikiamas naujų registruotų atvejų skaičiaus santykinis pokytis (procentais) per paskutinę parą (`r max.date-1` - `r max.date` ). Žemėlapyje atvaizduojamos tik šalys turinčios daugiau nei 500 regsitruotų atvejų. Šis žemėlapis iliustruoja aktyviųs koronaviruso židinius pasaulyje.

```{r, echo=FALSE}


df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T), round(max(df$value, na.rm = T)*0.9))


ggplot(df, aes(fill=value))+
  geom_sf()+
  ylim(-55,80)+
  xlim(-130,140)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Procentai",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Naujų atvejų skaičiaus proc. pokytis per paskutinę parą (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```


## Pasaulis - statistika 

### Pausaulis -pagrindiniai rodikliai{.tabset .tabset-fade .tabset-pills}
#### Bendras skaičius
```{r, echo=FALSE}
df <- data_world %>%
  group_by(date, var)%>%
  summarise(value=sum(value))

max.date <- max(df$date)

ggplot(df, aes(x=date, y=value, fill=var))+
  geom_area(alpha=0.5)+
  scale_fill_manual(values=c("red", "black"),
                    labels=c("Užsikrėtimai", "Mirę") )+
  scale_x_date(breaks="1 week")+
  scale_y_continuous(labels = comma)+
  labs(title=paste0("Pasaulinis koronaviruso atvejų skaičius ir pasiskirstymas (naujausi duomenys ", max.date, ")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```

#### Užsikrėtimai (ts, top 5)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:5,]%>%
  gather(date, value, 5:ncol(.))%>%
  mutate(date=as.Date(date))

ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
  geom_line(size=1.1)+
  geom_point(size=2)+
  scale_color_brewer(palette="Set1",type = "qualitative", name="Valstybės")+
  labs(
    title="Užsikrėtimų skaičius daugiausia patvirtintų atvejų turinčiose pasaulio šalyse",
    subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
    x="Laikotarpis",
    y="Užsikrėtimų skaičius"
  )+
  scale_x_date(breaks = "1 week")+
  theme(axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))

```


#### Užsikrėtimai (ts, top 6-16 vietos)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[6:16,]%>%
  gather(date, value, 5:ncol(.))%>%
  mutate(date=as.Date(date))

ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
  geom_line(size=1.1)+
  geom_point(size=2)+
  scale_color_brewer(palette="Paired",type = "qualitative", name="Valstybės")+
  labs(
    title="Užsikrėtimų skaičius daugiausia patvirtintų atvejų turinčiose pasaulio šalyse (6-16 vietos)",
    subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
    x="Laikotarpis",
    y="Užsikrėtimų skaičius"
  )+
  scale_x_date(breaks = "1 week")+
  theme(axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))
```





### Užsikrėtimai{.tabset .tabset-fade .tabset-pills}
#### Užsikrėtimai (abs)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         date==max(.$date))%>%
  select (valstybe, value)%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius, top 20 valstybių ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Užsikrėtimai (abs, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value)%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius per paskutinę parą, top 20 valstybių ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Užsikrėtimai (/pop)
```{r, echo=FALSE}
max.date<-max(data_world$date)
pop_world <- data.frame(SOVEREIGNT=shape$SOVEREIGNT, POP_EST=shape$POP_EST, stringsAsFactors = FALSE)

df <- data_world %>%
  filter(var=="confirmed",
         date==max(.$date))%>%
  left_join(., pop_world, by=c("country"="SOVEREIGNT"))%>%
  mutate(value_pop=round(value/POP_EST*1000000,1))%>%
  top_n(.,20,value_pop)

ggplot(df,aes(x=reorder(valstybe,-value_pop), y=value_pop)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value_pop, y=value_pop), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius tenkantis 100.000 gyventojų ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Užsikrėtimai (/pop, d/d)

```{r, echo=FALSE}
max.date<-max(data_world$date)
pop_world <- data.frame(SOVEREIGNT=shape$SOVEREIGNT, POP_EST=shape$POP_EST, stringsAsFactors = FALSE)

df <- data_world %>%
  filter(var=="confirmed",
         date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
    left_join(., pop_world, by=c("country"="SOVEREIGNT"))%>%
  mutate(value_pop=round(value/POP_EST*1000000,1))%>%
  top_n(.,20,value_pop)


ggplot(df,aes(x=reorder(valstybe,-value_pop), y=value_pop)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value_pop, y=value_pop), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius tenkantis 100.000 gyventojų ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Užsikrėtimai (proc. d/d)

```{r, echo=FALSE}
max.date<-max(data_world$date)

df <- data_world %>%
  filter(var=="confirmed")%>%
    filter(date==max.date-1|date==max.date,
           value>=1)%>%
  spread(date, value)%>%
  mutate(value=round((.[,6]/.[,5]-1)*100,0))%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Užsikrėtimų per paskutinę parą pokytis, % ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Valstybė", 
       y="proc. pokytis")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Užsikrėtimai (ts, top 6)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:6,]%>%
  gather(date, value, 5:ncol(.))%>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value)))%>%
  mutate(date=as.Date(date))

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_bar(stat="identity")+
  scale_x_date(breaks="1 week")+
  labs(title=paste0('Dieninis naujų užsikrėtimų skaičius skaičius (top 6 valstybėse su daugiausia užsikrėtimų)',max.date),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius") +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~valstybe, ncol=3, 
             nrow = 2, 
             scales='free')   

```

### Mirtys {.tabset .tabset-fade .tabset-pills}

#### Mirtys (abs)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         date==max(.$date))%>%
  select (valstybe, value)%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Mirčių skaičius", 
       title=paste0("Mirčių skaičius, top 20 valstybių ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (abs, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths")%>%
  filter(date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value)%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (/pop)
```{r, echo=FALSE}
max.date<-max(data_world$date)
pop_world <- data.frame(SOVEREIGNT=shape$SOVEREIGNT, POP_EST=shape$POP_EST, stringsAsFactors = FALSE)

df <- data_world %>%
  filter(var=="deaths",
         date==max(.$date))%>%
  left_join(., pop_world, by=c("country"="SOVEREIGNT"))%>%
  mutate(value_pop=round(value/POP_EST*1000000,1))%>%
  top_n(.,20,value_pop)

ggplot(df,aes(x=reorder(valstybe,-value_pop), y=value_pop)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value_pop, y=value_pop), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Mirčių skaičius", 
       title=paste0("Mirčių skaičius tenkantis 100.000 gyventojų ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtys (/pop, d/d)

```{r, echo=FALSE}
max.date<-max(data_world$date)
pop_world <- data.frame(SOVEREIGNT=shape$SOVEREIGNT, POP_EST=shape$POP_EST, stringsAsFactors = FALSE)

df <- data_world %>%
  filter(var=="deaths")%>%
  filter(date==max.date-1|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  left_join(., pop_world, by=c("country"="SOVEREIGNT"))%>%
  mutate(value_pop=round(value/POP_EST*1000000,1))%>%
  top_n(.,20,value_pop)

ggplot(df,aes(x=reorder(valstybe,-value_pop), y=value_pop)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value_pop, y=value_pop), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius 100.000 gyventojų per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtys (proc. d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths")%>%
    filter(date==max.date-1|date==max.date,
           value>=1)

max.date<-max(df$date)

df%<>%
  spread(date, value)%>%
  na.omit()%>%
  mutate(value=round((.[,6]/.[,5]-1)*100,0))%>%
  top_n(.,20,value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Mirčių per paskutinę parą pokytis, % ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Valstybė", 
       y="proc. pokytis")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtingumas (top 20)

```{r,echo=FALSE}
df <- data_world %>%
  filter(var%in%c("deaths","confirmed"),
         date==max(date))%>%
  spread(var,value)%>%
  mutate(deathrate=deaths/confirmed*100)%>%
  mutate_at(vars(deathrate),funs(round(.,2)))%>%
  arrange(deaths)%>%
  top_n(.,20, confirmed)

ggplot(df,aes(x=reorder(valstybe,-deathrate), y=deathrate, fill=valstybe))+
  geom_bar(stat='identity',
           fill="steelblue") +
  geom_text(aes(label=deathrate, y=deathrate), size=2.5, vjust=-0.5)+
  labs(x="Valstybė", y="Mirtingumas, %", title="Mirtingumas top 20 pasaulio šalių pagal mirčių skaičių", subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (ts, top 6)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths")%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:6,]%>%
  gather(date, value, 5:ncol(.))%>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value)))%>%
  mutate(date=as.Date(date))

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_bar(stat="identity")+
  scale_x_date(breaks="1 week")+
  labs(title=paste0('Dieninis mirčių skaičius skaičius (6 valstybėse su daugiausia mirčių) ',
                    max.date),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius") +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~valstybe, ncol=3, 
             nrow = 2, 
             scales='free_y')   

```

# Europos statistika

## Europa - žemėlapiai {.tabset .tabset-fade .tabset-pills}

### Užsikrėtimai (abs.)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date),)

max.date <- max(df$date)


df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(1,10, 100, 1000, 20000)

ggplot(df, aes(fill=value))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  geom_sf_label(aes(label =round(value,0)), size=2.5, fill="white" )+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```

### Užsikrėtimai (/pop.)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date),)

max.date <- max(df$date)

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))%>%
  mutate(POP_EST=as.numeric(POP_EST))%>%
  mutate(value_pop=value/POP_EST*1000000)

# summary(df$value_pop)
# min(df$value_pop,na.rm = T)
# max(df$value_pop,na.rm = T)

my_breaks <- c(0.5,2.5, 10,50,250)

ggplot(df, aes(fill=value_pop))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Patvirtintų apsikrėtusiųjų skaičius tenkantis 1 mln. gyventojų (duomenys ",max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")
```


### Nauji (abs.)

```{r, echo=FALSE}
df <- data_world%>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date)-1 | date==max(date) )%>%
  spread(date, value)%>%
  mutate(diff=.[,6]-.[,5])%>%
  select(1,4,7)%>%
  rename(value=diff)

max.date <- max(data_world$date)
```

Žemiau pateikiamas naujų registruotų atvejų absoliutus skaičiaus pokytis per paskutinę parą (`r max.date-1` - `r max.date` ). Iš šio žemėlapio galima matyti, kur atsirado daugiausiai naujų atvejų.

```{r, echo=FALSE}

df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(min(df$value, na.rm = T),1, 10, 100, 1000, max(df$value, na.rm = T))


ggplot(df, aes(fill=value))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
  geom_sf_label(aes(label =round(value,0)), size=2.5, fill="white" )+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Naujų atvejų skaičiaus per paskutinę parą (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```


### Nauji (proc.)

```{r, echo=FALSE}
df <- data_world%>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH","ME","MK","AL","RS","TR","BA","XK", "RU", "BY", "UA", "MD", "MA", "DZ", "TN"),
         date==max(date)-1 | date==max(date) )%>%
  spread(date, value)%>%
  mutate(diff=round((.[,6]/.[,5]-1)*100,1))%>%
  filter(.[,5]>=10)%>% # to exclude inf as result sof x/0
  select(1,4,7)%>%
  rename(value=diff)

max.date <- max(data_world$date)
```

Žemiau pateikiamas naujų registruotų atvejų skaičiaus santykinis pokytis (procentais) per paskutinę parą (`r max.date-1` - `r max.date` ). Žemėlapyje atvaizduojamos tik šalys turinčios daugiau nei 10 regsitruotų atvejų. Šis žemėlapis iliustruoja aktyviųs koronaviruso židinius pasaulyje.

```{r, echo=FALSE}


df <- left_join(shape, df, by=c("SOVEREIGNT"="country"))

# min(df$value,na.rm = T)
# max(df$value,na.rm = T)

my_breaks <- c(round(min(df$value, na.rm = T)*1.1),1,3,10, round(max(df$value, na.rm = T)*0.9))


ggplot(df, aes(fill=value))+
  geom_sf()+
  xlim(-20,38)+
  ylim(38,70)+
    geom_sf_label(aes(label =round(value,0)), size=2.5, fill="white" )+
  scale_fill_gradientn(colours=brewer.pal(name ="YlOrRd", n=9),
                       name="Skaičius",
                       trans="log",
                       na.value = "grey100",
                       breaks=my_breaks,
                       labels=my_breaks)+
  labs(title=paste0("Naujų atvejų skaičiaus proc. pokytis per paskutinę parą (duomenys ", max.date,")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt")

```

## Europa - statistika

### Europa pagrindiai rodikliai{.tabset .tabset-fade .tabset-pills}

#### Bendras skaičius
```{r, echo=FALSE}
df <- data_world %>%
  filter(CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  group_by(date, var)%>%
  summarise(value=sum(value))

max.date <- max(df$date)


ggplot(df, aes(x=date, y=value, fill=var))+
  geom_area(alpha=0.5)+
  scale_fill_manual(values=c("red", "black"),
                    labels=c("Aktyvūs", "Mirę") )+
  scale_x_date(breaks="1 week")+
  scale_y_continuous(labels=comma)+
  labs(title=paste0("EEE koronaviruso atvejų skaičius ir pasiskirstymas (naujausi duomenys ", max.date, ")"),
       subtitle = "Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```


#### Užsikrėtimai (ts, top 10)
```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:10,]%>%
  gather(date, value, 5:ncol(.))%>%
  mutate(date=as.Date(date))

ggplot(df, aes(x=date, y=value, color=valstybe, group=valstybe)) +
  geom_line(size=1.1)+
  geom_point(size=2)+
  scale_color_brewer(palette="Paired",type = "qualitative", name="Valstybės")+
  labs(
    title="Užsikrėtimų skaičius daugiausia patvirtintų atvejų turinčiose šalyse",
    subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
    x="Laikotarpis",
    y="Užsikrėtimų skaičius"
  )+
  scale_x_date(breaks = "1 week")+
  theme(axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))
```


### Europa - užsikrėtimai{.tabset .tabset-fade .tabset-pills}

#### Užsikrėtimai (abs)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  filter(date==max(.$date))%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų  skaičius, suminis ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Užsikrėtimai (abs, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"),
         date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Naujų Užsikrėtimų  skaičius per paskutinę dieną ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Užsikrėtimai (/pop)

```{r, echo=FALSE}
max.date<-max(data_world$date)

pop <- get_eurostat("tps00001") %>% 
  filter(time=="2019-01-01")%>%
  rename(CNTR_CODE=geo,
         pop=values)%>%
  select(CNTR_CODE, pop)

df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"),
         date==max(date))%>%
  select (valstybe, value, CNTR_CODE)%>%
  left_join(., pop, by="CNTR_CODE")%>%
  mutate(value=round((value/pop*100000),1))%>%
  select(valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Užsikrėtimų skaičius 100.000 gyventojų ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```


#### Užsikrėtimai (/pop, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-1|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value, CNTR_CODE)

pop <- get_eurostat("tps00001") %>% 
  filter(time=="2019-01-01")%>%
  rename(CNTR_CODE=geo,
         pop=values)%>%
  select(CNTR_CODE, pop)


df <- left_join(df, pop, by="CNTR_CODE")%>%
  mutate(value=round((value/pop*100000),1))%>%
  select(valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Naujų Užsikrėtimų skaičius 100.000 gyventojų per paskutinę dieną ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Užsikrėtimai (proc.)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-1|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=round((.[,6]/.[,5]-1)*100),0)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Naujų Užsikrėtimų per paskutinę dieną, % ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Valstybė", 
       y="proc. pokytis")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```


#### Užsikrėtimai (ts, top 6)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="confirmed",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:6,]%>%
  gather(date, value, 5:ncol(.))%>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value)))%>%
  mutate(date=as.Date(date))

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_bar(stat="identity")+
  scale_x_date(breaks="1 week")+
  labs(title=paste0('Dieninis naujų užsikrėtimų skaičius skaičius (6 Europos valstybėse su daugiausia užsikrėtimų) ',
                    max.date),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius") +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~valstybe, ncol=3, 
             nrow = 2, 
             scales='free_y')   

```


### Europa - mirtys {.tabset .tabset-fade .tabset-pills}

#### Mirtys (abs)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  filter(date==max(.$date))%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (abs, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  filter(date==max(.$date)-1|date==max(.$date))%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (/pop)

```{r, echo=FALSE}

max.date<-max(data_world$date)

df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"),
         date==max(.$date))%>%
  select (valstybe, value, CNTR_CODE)

pop <- get_eurostat("tps00001") %>% 
  filter(time=="2019-01-01")%>%
  rename(CNTR_CODE=geo,
         pop=values)%>%
  select(CNTR_CODE, pop)


df <- left_join(df, pop, by="CNTR_CODE")%>%
  mutate(value=round((value/pop*100000),1))%>%
  select(valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius 100.000 gyventojų per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```


#### Mirtys (/pop, d/d)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))

max.date<-max(df$date)

df <- df %>%
  filter(date==max.date-1|date==max.date)%>%
  spread(date, value)%>%
  mutate(value=.[,6]-.[,5])%>%
  select (valstybe, value, CNTR_CODE)

pop <- get_eurostat("tps00001") %>% 
  filter(time=="2019-01-01")%>%
  rename(CNTR_CODE=geo,
         pop=values)%>%
  select(CNTR_CODE, pop)


df <- left_join(df, pop, by="CNTR_CODE")%>%
  mutate(value=round((value/pop*100000),1))%>%
  select(valstybe, value)

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(x="Valstybė", 
       y="Užsikrėtimų skaičius", 
       title=paste0("Mirčių skaičius 100.000 gyventojų per paskutinę parą ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, Skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtys (proc, d/d)

```{r, echo=FALSE}
max.date<-max(data_world$date)

df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
    filter(date==max.date-1|date==max.date,
           value>=1)%>%
  spread(date, value)%>%
  na.omit()%>%
  mutate(value=round((.[,6]/.[,5]-1)*100,0))

ggplot(df,aes(x=reorder(valstybe,-value), y=value)) +
  geom_bar(stat='identity',
           fill="steelblue")+
  geom_text(aes(label=value, y=value), size=3, vjust=-0.75)+
  labs(title=paste0("Mirčių per paskutinę parą pokytis, % ( ", max.date, " duomenimis)"),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Valstybė", 
       y="Proc. pokytis")+
  theme(legend.title=element_blank(),
        legend.position='none',
        axis.text.x=element_text(angle=45, hjust=1))
```

#### Mirtingumas

```{r,echo=FALSE}
df <- data_world %>%
  filter(var%in%c("deaths","confirmed"),
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"),
         date==max(date))%>%
  spread(var,value)%>%
  mutate(deathrate=deaths/confirmed*100)%>%
  mutate_at(vars(deathrate),funs(round(.,2)))%>%
  arrange(deaths)%>%
  top_n(.,20, confirmed)

ggplot(df,aes(x=reorder(valstybe,-deathrate), y=deathrate, fill=valstybe))+
  geom_bar(stat='identity',
           fill="steelblue") +
  geom_text(aes(label=deathrate, y=deathrate), size=2.5, vjust=-0.5)+
  labs(x="Valstybė", y="Mirtingumas, %", title="Mirtingumas EEE valstybėse", subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt" )+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))

```

#### Mirtys (ts, top 6)

```{r, echo=FALSE}
df <- data_world %>%
  filter(var=="deaths",
         CNTR_CODE %in% c("BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","UK","IS","LI","NO","CH"))%>%
  spread(date, value)%>%
  arrange(desc(.[,ncol(.)]))%>%
  .[1:6,]%>%
  gather(date, value, 5:ncol(.))%>%
  group_by(valstybe) %>%
  mutate(diff = value - lag(value, default = first(value)))%>%
  mutate(date=as.Date(date))

max.date<-max(df$date)

ggplot(df, aes(x=date, y=diff)) +
  geom_bar(stat="identity")+
  scale_x_date(breaks="1 week")+
  labs(title=paste0('Dieninis mirčių skaičius skaičius (6 Europos valstybėse su daugiausia mirčių) ',
                    max.date),
       subtitle="Šaltinis: JHCSSE, skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius") +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~valstybe, ncol=3, 
             nrow = 2, 
             scales='free_y')   

```


# Lietuva
```{r}
df <- data_lt_country_cum %>%
  filter(date==max(date))%>%
  spread(var, values)
time_now <- format(Sys.time(), "%Y-%m-%d %H:%M")
```

Naujausiais duomenimis (`r time_now`) Lietuvoje šiuo metu yra:

* iš viso registruotų atvejų - `r df$confirmed `
* iš jų pasveiko - `r df$recovered `
* iš jų mirė - `r df$deaths`
* likęs aktyvių atvejų  skaičius - `r df$active `

## Lietuva - žemėlapiai {.tabset .tabset-fade .tabset-pills}

Deja SAM neskelbia detalios informacijos apie pacientų gyvenamąją vietą, todėl žemiau patiekti žemėlapiai remiasi mūsų surinkta informacija iš įvairių šaltinių: SAM, žiniasklaidos, ligoninių bei kitų pranešimų. Todėl skaičiuse galima paklaida.

## Lietuva - statistika {.tabset .tabset-fade .tabset-pills}
### Bendras atvejų skaičius
```{r, echo=FALSE}

df <- data_lt_county_cum%>%
  filter(var!="confirmed") %>%
  mutate(var=factor(var, levels=c("active", "recovered", "deaths")))%>%
  group_by(date, var)%>%
  summarise(values=sum(values))

max.date <- max(df$date)

ggplot(df, aes(x=date, y=values, fill=var))+
  geom_area(alpha=0.5)+
  scale_fill_manual(values=c("red", "green", "black"),
                    labels=c("Aktyvūs", "Pasveikę", "Mirę") )+
  scale_x_date(breaks="1 day")+
  labs(title=paste0("Lietuvos koronaviruso atvejų skaičius ir pasiskirstymas (naujausi duomenys ", max.date, ")"),
       subtitle = "Šaltinis ir skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```


```{r, echo=FALSE}

df <- data_lt_country%>%
  filter(var=="confirmed",
         date>="2020-02-28")


max.date <- max(df$date)

ggplot(df, aes(x=date, y=values, fill=var))+
  geom_bar( stat = "identity",
            fill="steelblue")+
  scale_x_date(breaks="1 day")+
  geom_text(aes(label=values, y=values), size=2.5, vjust=-0.5)+
  labs(title=paste0("Naujų atvejų skaičius (naujausi duomenys ", max.date, ")"),
       subtitle = "Šaltinis ir skaičiavimai: Corona-Stat.lt",
       x="Data",
       y="Skaičius")+
  theme(legend.title=element_blank(),
        legend.position='bottom',
        axis.text.x = element_text(angle = 45, hjust = 1))
```

## Ištyrimai

Lietuvoje testuojamų asmenų skaičius nėra didelis (palyginus su Latvija ar Estija) dėl ypatingai mažo turimų reagentų skaičiaus. Todėl 2020-03-21/22 dienomis netgi buvo [apribotas mėginių ėmimas Kauno ir Klaipėdos mobiliame punkte. 2020-02-21 Lietuvoje buvo apie 1300 reagentų (2020-02-21 atlitki 384 testai).](https://www.15min.lt/naujiena/aktualu/lietuva/likus-700-reagentu-gali-buti-tiriami-ne-visi-eminiai-is-mobiliosios-patikros-punktu-56-1293308). 

```{r}
pop <- demo_r_pjangrp%>%
  filter(NUTS_ID %in% c("LT", "LV", "EE"))%>%
  select(NUTS_ID, pop)%>%
  data.frame()

lt <- data_lt %>%
  select(date, tested_total)%>%
  rename(tested_total_lt=tested_total)

lv <- data_lv %>%
  select(date, tested_total)%>%
  rename(tested_total_lv=tested_total)

ee <- data_ee %>%
  select(date, tested_total)%>%
  rename(tested_total_ee=tested_total)

df <- merge(lt,lv)%>% merge(.,ee) %>%
  mutate(
    tested_total_lt_p=tested_total_lt/pop[3,2]*1000,
    tested_total_lv_p=tested_total_lv/pop[2,2]*1000,
    tested_total_ee_p=tested_total_ee/pop[1,2]*1000
  )%>%
  gather(var, values, 2:7)%>%
  mutate(case=rep(c("Skaičius", "Skaičius tenkantis 1000 gyventojų"), each=nrow(.)/2),
         geo=rep(c("Lietuva", "Latvija", "Estija"), each=nrow(lt), times=2))

ggplot(df, aes(date, values, col=geo))+
  geom_line(size=1.1)+
  geom_point(size=2)+
  scale_color_brewer(palette="Set1",type = "qualitative", name="Valstybės")+
  labs(
    title="Testavimo apimtys Baltijos šalyse",
    subtitle="Šaltinis ir skaičiavimai: Corona-Stat.lt",
    x="Laikotarpis",
    y="Skaičius"
  )+
  scale_x_date(breaks = "2 day")+
  theme(legend.position = "bottom",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))+
  facet_wrap(~case, scales = "free_y")
```

## Rizikos statistika

### "Leiskime persirgti"?

Kurį laiką [Junktinės Karalystės valdžia tikėjosi, jog gali leisti sirgti visiems](https://www.theguardian.com/world/2020/mar/13/herd-immunity-will-the-uks-coronavirus-strategy-work) tam, jog persirgę asmenys įgytų įmunitetą koronavirusui. Visgi, kai [JK premjeras B. Johnson buvo supažindintas su galimomis pasekmėmis (mirčių skaičiumi iki 250 000)](https://www.thenational.scot/news/18310373.coronavirus-250-000-expected-die-britain-boris-johnsons-plan/), JK ėmėsi prieminių kaip riboti viruso plitimą. 

Žemiau lentelėje mes nusprendėme paskaičiuoti, kas nutiktų, jeigu Lietuvoje būtų siekiama leisti persirgti visiems.  Skaičiavimams naudojome [Kinijos Užkrečiamių ligų kontrolės ir prevencijos centro pateiktą statistiką apie mirtingumą susirgus](http://weekly.chinacdc.cn/en/article/id/e53946e2-c6c4-41e9-9a9b-fea8db1a8f51), bei Lietuvos Statistikos departamento duomenis apie 2020 metų gyventojų sudėtį savivaldybėse pagal amžiaus grupes.

Pateikiami 10 scenarijų, kai persarga nuo 10 iki 100 % populiacijos. Įvairiais medikų pasisakymais, bandos imuniteto ("herd-immunity"), būtų galima pasiekti, kai perserga bent 60 % populiacijos. Tad laikytume tai, baziniu scneraijumi. Išvadadas siulome pasidaryti patiems. Kiekvienos savivaldybės įverčius rasite priede [excel file](https://github.com/justasmundeikis/corona-stat-lt/raw/master/data/osp/e_table_risk_county.xlsx)

```{r}
kable(table_risk_agg)%>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),full_width = F,fixed_thead = T)
```


```{r}
kable(table_risk_age_group)%>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),full_width = F,fixed_thead = T)

```

## Medicinos pajėgumai


# Ekonominiai rodikliai
Kai tik atsiras statistiniai rodikliai, pradėsije juos pildyti šioje skiltyje. Šiuo metu tiek Lietuvoje, tiek visame pasaulyje ekonomistai, ekonometrikai, analitikai ir kas tik netingi išreiškia koiekybines prognozes. Deja jos visos remiasi išimtinai prielaidomis, o ne faktais. Kiekybiškai įvertinti koronaviruso sukeliamos pasaulinės recesijos šiuo metu dar nėra įmanoma. 

## VMI paskelbtas įmonių sąrašas {.tabset .tabset-fade .tabset-pills}
Nežinau ar dėl to, jog mes (ir tikiu ne tik mes) palaidome robotukus nuskaityti vmi.lt tinklapyje esančią informaciją, 2020-03-23 VMI paviešino įmonių, kurios mokesčiams sumokėti arba mokestinės paskolos sutarčiai, be palūkanų sudaryti, turės du mėnesius, [sąrašą](https://www.vmi.lt/cms/informacija-verslui-del-covid-19). Saraše - `r nrow(vmi)` įmonės. Pagal šį sudarytą sąrašą galiem vertinti, kokios įmonės (VMI supratimu) susidurs su ekonominiais sunkumais. 

###

```{r}
df <- vmi %>%
  select(`EV sekcija`)%>%
  group_by(`EV sekcija`)%>%
  summarise(Skaičius=n())%>%
  arrange(desc(Skaičius))

ggplot(df, aes(reorder(`EV sekcija`, Skaičius), Skaičius))+
  geom_bar(stat = "identity",
           fill="steelblue")+
  coord_flip()+
  geom_text(aes(label=Skaičius, y=Skaičius), size=2.5, hjust=-0.1)+
  labs(title="VMI įmonių sąrašas pagal ekonominės veiklos sekcijas", 
       subtitle="Šaltinis: vmi.lt, skaičiavimai: Corona-Stat.lt",
       x="EV skyrius", y="Įmonių skaičius")+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))



```

###
  
```{r}
df <- vmi %>%
  select(`EV skyrius`)%>%
  group_by(`EV skyrius`)%>%
  summarise(Skaičius=n())%>%
  arrange(desc(Skaičius))

ggplot(df, aes(reorder(`EV skyrius`, Skaičius), Skaičius))+
  geom_bar(stat = "identity",
           fill="steelblue")+
  coord_flip()+
  geom_text(aes(label=Skaičius, y=Skaičius), size=2.5, hjust=-0.1)+
  labs(title="VMI įmonių sąrašas pagal ekonominės veiklos skyrius", 
       subtitle="Šaltinis: vmi.lt, skaičiavimai: Corona-Stat.lt",
       x="EV skyrius", y="Įmonių skaičius")+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))



```

###

```{r}
df <- vmi %>%
  select(`JA teisinė forma`)%>%
  group_by(`JA teisinė forma`)%>%
  summarise(Skaičius=n())%>%
  arrange(desc(Skaičius))

ggplot(df, aes(reorder(`JA teisinė forma`, Skaičius), Skaičius))+
  geom_bar(stat = "identity",
           fill="steelblue")+
  coord_flip()+
  geom_text(aes(label=Skaičius, y=Skaičius), size=2.5, hjust=-0.1)+
  labs(title="VMI įmonių sąrašas pagal įmonių teisinę formą", 
       subtitle="Šaltinis: vmi.lt, skaičiavimai: Corona-Stat.lt",
       x="Teisinė forma", y="Įmonių skaičius")+
  theme(legend.title=element_blank(),
        legend.position="",
        axis.text=element_text(size=8),
        axis.text.x=element_text(angle=45, hjust=1))

```

Artimiausiu metu bus pateikta daugiau įžvalgų iš VMI duomenų...




## Lietuva{.tabset .tabset-fade .tabset-pills}
### BVP
### Pramonės produkcija
### Užsienio prekyba
### Mažmeninė preyba
### Infliacija
### Kreditai
### Užimtumas / nedarbas

## Pagrindinės ES šalys{.tabset .tabset-fade .tabset-pills}
### BVP
### Pramonės produkcija
### Užsienio prekyba
### Mažmeninė preyba
### Infliacija
### Kreditai
### Užimtumas / nedarbas


# Prognozės
## Sergamumo statistikos prognozės
Nors internete pasirodo vis daugiau prognozių, kokios pandemijos galima tikėtis Lietuvoje, mes labai abejojame tokių (kaip ir savų) prognozių tiklsumu. Leiskite paaiškinti: prognozės apie sergamumą dažniauriai remiasi SIR (modeliu), kuriam kalibruoti imami jau surinkti šalies duomenys, arba naudojami tarptautiniai parametrai. Abu variantai netinkami prognozuoti koronaviruso pliltimui šalyje. 

Pasauliniai parametrai, pvz., apie užkrečiamumą, kuris nusako kaip sparčiai dauginsis virusas, neįtraukia Lietuvoje priimtų priemonių - karantino (prekybos centrų, restoranų ir kitų viešų renginių uždarymo). Taip pat šiuos parametrus keičia ir žmonių elgesys, kiek populaicija imasi labiau save saugoti - plauti rankas, dezinfektuoti paviršius, dėvėti apsaugines kaukes. Šiuos parametrus, priklausomai nuo taikytų priemonių epidemiologai bandys nnustatyti PO pandemijos, siekdami įvertinti kokie veiksmai turėjo kokią įtaką. Šiuo metu, tai padaryti neįmanoma.

Kitas variantas yra kalibruoti modelį naudojant faktinius registruotų sirgimų skaičius. Tai darome ir mes. Tačiau čia iškyla kitos problemos:

* dauguma pradinių atvejų buvo įvežtiniai. Taigi užregistruoti atvejai atspindi ne viruso plitimą šalyje, o įvežtinius atvejus. Būtent dėl šios priežasites laikome, jog [A.Ghorbal prognozė](https://www.delfi.lt/news/daily/lithuania/sukure-koronaviruso-plitimo-lietuvoje-modeli-kada-pasieksime-pika.d?id=83871709), kai remiamasi įvežtinių atvejų duomenimis, yra niekinė.

* dėl labai riboto testavimo (mūsų supratimu, iki šiol testavimas yra per mažos apimties, siekiant suvaldyti pandemiją) "atvejų statistika" visiškai neatspindi realybės. Kol įvežtinių atvejų skaičius nebuvo didelis, sudaryti galimą kontaktą turėjusių asmenų sąrašą ir nedelsiant testuoti visus šiuos asmenis ir asmenis su kuriais jie turėjo kontaktą - buvo galimas, tačiau nepakako reagentų to daryti. Nuo 2020-03-20 SAM nebeskelbia statistikos apie stebimus asmenis, nes tikėtina šis asmenų skaičius yra išaugęs eksponentiškai ir atsekti visų atvejų yra nebeįmanoma. Labai galimas scenarijus, jog šiuo metu Leituvoje yra didelis COVID užsikrėtimų skaičius, tačiau testuojami ir nustatoma vis dar tik dalis, kuri potencialiai turėjo kontaktą, taip iškreipiant imtį. Iš kitos pusės, asmenys užsikrėtę ir turintys simptomus, nebūtinai sulaukia testavimo ir nepakliūna į statistiką.

Ko gero viena geriausių statistikų bus autopsijų rezultatai, kuriuose bus nustatyta ar asmenys mirė dėl koronaviruso ar ne. Pagal mirčių statistiką bus galima pasibaigus pandemijai tikėtina tiklsiausiai atsakyti buvusį pandemijos mastą.

Turint omenyje visuos šiuos ribotumus, žemiau pristatome SIR kalibruoto modelio Lietuvoje prognozes. Modelis rekalbibruojasi kasdien, gavus daugiau duomenų apie užsikrėtimų skaičių

```{r}
df <- data_lt_country_cum %>%
        ungroup()%>%
        filter(var=="active")%>%
        select(-var)%>%
        filter(values>=10,
               date!=max(date))

  ```

Žemiau pateikiame supaprastiną grafiką, kuriame eliminuojame pirmus 10 atvejų. Pirmi 10 pasirinkti arbitriškai.
Kairysis grafikas iliustruoja faktinius sakčius. Labai gerai matomas augimo eksponentiškumas. Dešinysis grafikas iliustruoja logaritmuotus skaičius, tad matoma, kaip beveik labai "gražiai" logaritmuoti įverčiai sugula ant tiesės. Taigi iš esmės duomenys yra tinkami tolimensiai analizei taikant SIR modelį.

```{r}
par(mfrow = c(1, 2))
plot(df$date, df$values, xlab="Data", ylab="Skaičius")
plot(df$date, log10(df$values), xlab="Data", ylab="Skaičius, log10")
abline(lm(log10(df$values) ~ df$date))
title("Patvirtinti COVID-19 atvejai Lietuvoje", outer = TRUE, line = -2)

```


Žemiau pateikiami progostinio SIR modelio rezultatai

* Dešinysis grafikas iliustuoja tris kreives, kiek asmenų yra sveikų (juoda kreivė), kiek asmenų serga (raudona kreivė) ir kiek asmenų pasveiko arba mirė (žalia kreivė).
* Dešiniame graikė matyti, jog pikas būtų pasiektas ties 42 diena po to, kai šalyje buvo registruota 10 atvejų, mūsų atveju tai 2020-04-24
* Dešiniame grafike atkartojamas kairysis grafikas, tik y-skalė yra pritaikyta geriau įskaityti užsikrėtusiųjų statistiką. Burbuliukai pažymi faktinius registruotus susirgimus
* R0, parametras kuris nusako kiek vienas infektas asmuo užkrečia kitų asmenų šiuo metu siekia 1.89 kas yra ganėtinai žemas rezultatas ir indikacija tam, jog šiuo metu užfiksuojamų asmenų skaičius nėra tiklsus (yra per žemas)
* Pandemija piką turėtų pasiekti t+42 dienos
* Pandemijos piko metu, turėtų būti užsikrėtę 373830 asmenų
* Taikant prielaidą, jog mirs 10 procentų jų reikės plaučių ventiliavimo aparatė, tai reikštų, jog Lietuvai jų gali prireikti iki 38 tūkstančių vientų. Kovo pradžioje SAM ministro teigimu, jų turėjome apie 1300.



```{r}
Infected <- df$values
Day <- 1:(length(df$date))
N <- 2793471 


SIR <- function(time, state, parameters) {
        par <- as.list(c(state, parameters))
        with(par, {
                dS <- -beta/N * I * S
                dI <- beta/N * I * S - gamma * I
                dR <- gamma * I
                list(c(dS, dI, dR))
        })
}

init <- c(S = N-Infected[1], I = Infected[1], R = 0)

RSS <- function(parameters) {
        names(parameters) <- c("beta", "gamma")
        out <- ode(y = init, times = Day, func = SIR, parms = parameters)
        fit <- out[ , 3]
        sum((Infected - fit)^2)
}

Opt <- optim(c(0.5, 0.5), RSS, method = "L-BFGS-B", lower = c(0, 0), upper = c(1, 1)) # optimize with some sensible 
Opt_par <- setNames(Opt$par, c("beta", "gamma"))
t <- 1:70 # time in days
fit <- data.frame(ode(y = init, times = t, func = SIR, parms = Opt_par))


matplot(fit$time, fit[ , 2:4], type = "l", xlab = "Day", ylab = "Skaičius", lwd = 2, lty = 1, col = 1:3)
matplot(fit$time, fit[ , 2:4], type = "l", xlab = "Day", ylab = "Skaičius", lwd = 2, lty = 1, col = 1:3, log = "y")
## Warning in xy.coords(x, y, xlabel, ylabel, log = log): 1 y value <= 0
## omitted from logarithmic plot

points(Day, Infected)
legend("bottomright", c("Sveiki", "Užkrėsti", "Pasveikę/mirę"), lty = 1, lwd = 2, col = col, inset = 0.05)
title("SIR modelis Lietuvai", outer = TRUE, line = -2)
```